import{v as K,a6 as Gt,a7 as Rt,a8 as ht,a9 as Ut,aa as Tt,ab as yt,ac as Nt,S as kt,i as Ct,s as Mt,I as bt,K as Pt,b as W,M as X,l as Q,e as Dt,ad as Zt,t as J,f as Ft,h as $,T as b,ae as T,af as jt,ag as zt,ah as pt,ai as Ht,aj as _t,$ as qt,g as Vt,ak as Xt,al as ot,am as Yt,p as Kt,H as Wt,an as V,Q as Qt,u as Jt,q as $t,r as te,a as ee,m as ie,d as ne,ao as re,ap as oe,aq as se,a4 as ae,ar as le,as as ue,at as he,au as ce,av as de,aw as fe,a1 as pe,ax as _e}from"./index-09f9502f.js";import{g as me}from"./globals-7f7f1b26.js";import{t as ct,l as v,L as F,c as ge,m as ve,a as Le,o as mt,b as ye}from"./icons-ee9166e7.js";import{s as ke,h as Ce}from"./locationUtils-8996ab2f.js";import{a as Me}from"./init-9beff97c.js";import{c as be}from"./_commonjsHelpers-725317a4.js";import"./datesUtils-5f8af51f.js";import"./auth-f14ad06a.js";import"./endpoints-b6cf54a2.js";import"./spot-3b7b98da.js";import"./transformers-2ad5cf36.js";function A(){return A=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(r[a]=o[a])}return r},A.apply(this,arguments)}function Pe(r,n){r.prototype=Object.create(n.prototype),r.prototype.constructor=r,tt(r,n)}function tt(r,n){return tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,a){return o.__proto__=a,o},tt(r,n)}function we(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function lt(r,n,o){return lt=we()?Reflect.construct.bind():function(a,h,t){var e=[null];e.push.apply(e,h);var i=new(Function.bind.apply(a,e));return t&&tt(i,t.prototype),i},lt.apply(null,arguments)}function S(r,n,o,a){n===void 0&&(n=""),a===void 0&&(a={});var h=document.createElement(r);return n&&(h.className=n),Object.keys(a).forEach(function(t){if(typeof a[t]=="function"){var e=t.indexOf("on")===0?t.substr(2).toLowerCase():t;h.addEventListener(e,a[t])}else t==="html"?h.innerHTML=a[t]:t==="text"?h.innerText=a[t]:h.setAttribute(t,a[t])}),o&&o.appendChild(h),h}function N(r){r.preventDefault(),r.stopPropagation()}var Y=function(){return[].slice.call(arguments).filter(Boolean).join(" ").trim()};function B(r,n){r&&r.classList&&(Array.isArray(n)?n:[n]).forEach(function(o){r.classList.contains(o)||r.classList.add(o)})}function w(r,n){r&&r.classList&&(Array.isArray(n)?n:[n]).forEach(function(o){r.classList.contains(o)&&r.classList.remove(o)})}var et,it=13,ut=40,wt=38,Se=[it,27,ut,wt,37,39],Ee=function(){function r(o){var a=this,h=o.handleSubmit,t=o.searchLabel,e=o.classNames,i=e===void 0?{}:e;this.container=void 0,this.form=void 0,this.input=void 0,this.handleSubmit=void 0,this.hasError=!1,this.container=S("div",Y("geosearch",i.container)),this.form=S("form",["",i.form].join(" "),this.container,{autocomplete:"none",onClick:N,onDblClick:N,touchStart:N,touchEnd:N}),this.input=S("input",["glass",i.input].join(" "),this.form,{type:"text",placeholder:t||"search",onInput:this.onInput,onKeyUp:function(s){return a.onKeyUp(s)},onKeyPress:function(s){return a.onKeyPress(s)},onFocus:this.onFocus,onBlur:this.onBlur,onClick:function(){a.input.focus(),a.input.dispatchEvent(new Event("focus"))}}),this.handleSubmit=h}var n=r.prototype;return n.onFocus=function(){B(this.form,"active")},n.onBlur=function(){w(this.form,"active")},n.onSubmit=function(o){try{var a=this;return N(o),w(h=a.container,"error"),B(h,"pending"),Promise.resolve(a.handleSubmit({query:a.input.value})).then(function(){w(a.container,"pending")})}catch(t){return Promise.reject(t)}var h},n.onInput=function(){this.hasError&&(w(this.container,"error"),this.hasError=!1)},n.onKeyUp=function(o){o.keyCode===27&&(w(this.container,["pending","active"]),this.input.value="",document.body.focus(),document.body.blur())},n.onKeyPress=function(o){o.keyCode===it&&this.onSubmit(o)},n.setQuery=function(o){this.input.value=o},r}(),xe=function(){function r(o){var a=this,h=o.handleClick,t=o.classNames,e=t===void 0?{}:t,i=o.notFoundMessage;this.handleClick=void 0,this.selected=-1,this.results=[],this.container=void 0,this.resultItem=void 0,this.notFoundMessage=void 0,this.onClick=function(s){if(typeof a.handleClick=="function"){var l=s.target;if(l&&a.container.contains(l)&&l.hasAttribute("data-key")){var c=Number(l.getAttribute("data-key"));a.clear(),a.handleClick({result:a.results[c]})}}},this.handleClick=h,this.notFoundMessage=i?S("div",Y(e.notfound),void 0,{html:i}):void 0,this.container=S("div",Y("results",e.resultlist)),this.container.addEventListener("click",this.onClick,!0),this.resultItem=S("div",Y(e.item))}var n=r.prototype;return n.render=function(o,a){var h=this;o===void 0&&(o=[]),this.clear(),o.forEach(function(t,e){var i=h.resultItem.cloneNode(!0);i.setAttribute("data-key",""+e),i.innerHTML=a({result:t}),h.container.appendChild(i)}),o.length>0?(B(this.container.parentElement,"open"),B(this.container,"active")):this.notFoundMessage&&(this.container.appendChild(this.notFoundMessage),B(this.container.parentElement,"open")),this.results=o},n.select=function(o){return Array.from(this.container.children).forEach(function(a,h){return h===o?B(a,"active"):w(a,"active")}),this.selected=o,this.results[o]},n.count=function(){return this.results?this.results.length:0},n.clear=function(){for(this.selected=-1;this.container.lastChild;)this.container.removeChild(this.container.lastChild);w(this.container.parentElement,"open"),w(this.container,"active")},r}(),st={position:"topleft",style:"button",showMarker:!0,showPopup:!1,popupFormat:function(r){return""+r.result.label},resultFormat:function(r){return""+r.result.label},marker:{icon:ct&&v.Icon?new v.Icon.Default:void 0,draggable:!1},maxMarkers:1,maxSuggestions:5,retainZoomLevel:!1,animateZoom:!0,searchLabel:"Enter address",clearSearchLabel:"Clear search",notFoundMessage:"",messageHideDelay:3e3,zoomLevel:18,classNames:{container:"leaflet-bar leaflet-control leaflet-control-geosearch",button:"leaflet-bar-part leaflet-bar-part-single",resetButton:"reset",msgbox:"leaflet-bar message",form:"",input:"",resultlist:"",item:"",notfound:"leaflet-bar-notfound"},autoComplete:!0,autoCompleteDelay:250,autoClose:!1,keepResult:!1,updateMap:!0},St="Leaflet must be loaded before instantiating the GeoSearch control",Oe={options:A({},st),classNames:A({},st.classNames),initialize:function(r){var n,o,a,h,t=this;if(!ct)throw new Error(St);if(!r.provider)throw new Error("Provider is missing from options");this.options=A({},st,r),this.classNames=A({},this.classNames,r.classNames),this.markers=new v.FeatureGroup,this.classNames.container+=" leaflet-geosearch-"+this.options.style,this.searchElement=new Ee({searchLabel:this.options.searchLabel,classNames:{container:this.classNames.container,form:this.classNames.form,input:this.classNames.input},handleSubmit:function(e){return t.onSubmit(e)}}),this.button=S("a",this.classNames.button,this.searchElement.container,{title:this.options.searchLabel,href:"#",onClick:function(e){return t.onClick(e)}}),v.DomEvent.disableClickPropagation(this.button),this.resetButton=S("button",this.classNames.resetButton,this.searchElement.form,{text:"Ã—","aria-label":this.options.clearSearchLabel,onClick:function(){t.searchElement.input.value===""?t.close():t.clearResults(null,!0)}}),v.DomEvent.disableClickPropagation(this.resetButton),this.options.autoComplete&&(this.resultList=new xe({handleClick:function(e){var i=e.result;t.searchElement.input.value=i.label,t.onSubmit({query:i.label,data:i})},classNames:{resultlist:this.classNames.resultlist,item:this.classNames.item,notfound:this.classNames.notfound},notFoundMessage:this.options.notFoundMessage}),this.searchElement.form.appendChild(this.resultList.container),this.searchElement.input.addEventListener("keyup",(n=function(e){return t.autoSearch(e)},(o=this.options.autoCompleteDelay)===void 0&&(o=250),a===void 0&&(a=!1),function(){var e=[].slice.call(arguments);h&&clearTimeout(h),h=setTimeout(function(){h=null,a||n.apply(void 0,e)},o),a&&!h&&n.apply(void 0,e)}),!0),this.searchElement.input.addEventListener("keydown",function(e){return t.selectResult(e)},!0),this.searchElement.input.addEventListener("keydown",function(e){return t.clearResults(e,!0)},!0)),this.searchElement.form.addEventListener("click",function(e){e.preventDefault()},!1)},onAdd:function(r){var n=this.options,o=n.showMarker,a=n.style;if(this.map=r,o&&this.markers.addTo(r),a==="bar"){var h=r.getContainer().querySelector(".leaflet-control-container");this.container=S("div","leaflet-control-geosearch leaflet-geosearch-bar"),this.container.appendChild(this.searchElement.form),h.appendChild(this.container)}return v.DomEvent.disableClickPropagation(this.searchElement.form),this.searchElement.container},onRemove:function(){var r;return(r=this.container)==null||r.remove(),this},open:function(){var r=this.searchElement,n=r.input;B(r.container,"active"),n.focus()},close:function(){w(this.searchElement.container,"active"),this.clearResults()},onClick:function(r){r.preventDefault(),r.stopPropagation(),this.searchElement.container.classList.contains("active")?this.close():this.open()},selectResult:function(r){if([it,ut,wt].indexOf(r.keyCode)!==-1)if(r.preventDefault(),r.keyCode!==it){var n=this.resultList.count()-1;if(!(n<0)){var o=this.resultList.selected,a=r.keyCode===ut?o+1:o-1,h=this.resultList.select(a<0?n:a>n?0:a);this.searchElement.input.value=h.label}}else{var t=this.resultList.select(this.resultList.selected);this.onSubmit({query:this.searchElement.input.value,data:t})}},clearResults:function(r,n){if(n===void 0&&(n=!1),!r||r.keyCode===27){var o=this.options,a=o.autoComplete;!n&&o.keepResult||(this.searchElement.input.value="",this.markers.clearLayers()),a&&this.resultList.clear()}},autoSearch:function(r){try{var n=this;if(Se.indexOf(r.keyCode)>-1)return Promise.resolve();var o=r.target.value,a=n.options.provider,h=function(){if(o.length)return Promise.resolve(a.search({query:o})).then(function(t){t=t.slice(0,n.options.maxSuggestions),n.resultList.render(t,n.options.resultFormat)});n.resultList.clear()}();return Promise.resolve(h&&h.then?h.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},onSubmit:function(r){try{var n=this;return Promise.resolve(n.options.provider.search(r)).then(function(o){o&&o.length>0&&n.showResult(o[0],r)})}catch(o){return Promise.reject(o)}},showResult:function(r,n){var o=this.options,a=o.autoClose,h=o.updateMap,t=this.markers.getLayers();t.length>=this.options.maxMarkers&&this.markers.removeLayer(t[0]);var e=this.addMarker(r,n);h&&this.centerMap(r),this.map.fireEvent("geosearch/showlocation",{location:r,marker:e}),a&&this.closeResults()},closeResults:function(){var r=this.searchElement.container;r.classList.contains("active")&&w(r,"active"),this.clearResults()},addMarker:function(r,n){var o=this,a=this.options,h=a.marker,t=a.showPopup,e=a.popupFormat,i=new v.Marker([r.y,r.x],h),s=r.label;return typeof e=="function"&&(s=e({query:n,result:r})),i.bindPopup(s),this.markers.addLayer(i),t&&i.openPopup(),h.draggable&&i.on("dragend",function(l){o.map.fireEvent("geosearch/marker/dragend",{location:i.getLatLng(),event:l})}),i},centerMap:function(r){var n=this.options,o=n.retainZoomLevel,a=n.animateZoom,h=r.bounds?new v.LatLngBounds(r.bounds):new v.LatLng(r.y,r.x).toBounds(10),t=h.isValid()?h:this.markers.getBounds();!o&&h.isValid()&&!r.bounds||o||!h.isValid()?this.map.setView(t.getCenter(),this.getZoom(),{animate:a}):this.map.fitBounds(t,{animate:a})},getZoom:function(){var r=this.options,n=r.zoomLevel;return r.retainZoomLevel?this.map.getZoom():n}};function Ie(){if(!ct)throw new Error(St);var r=v.Control.extend(Oe);return lt(r,[].slice.call(arguments))}(function(r){r[r.SEARCH=0]="SEARCH",r[r.REVERSE=1]="REVERSE"})(et||(et={}));var gt,Ae=function(){function r(o){o===void 0&&(o={}),this.options=void 0,this.options=o}var n=r.prototype;return n.getParamString=function(o){o===void 0&&(o={});var a=A({},this.options.params,o);return Object.keys(a).map(function(h){return encodeURIComponent(h)+"="+encodeURIComponent(a[h])}).join("&")},n.getUrl=function(o,a){return o+"?"+this.getParamString(a)},n.search=function(o){try{var a=this,h=a.endpoint({query:o.query,type:et.SEARCH});return Promise.resolve(fetch(h)).then(function(t){return Promise.resolve(t.json()).then(function(e){return a.parse({data:e})})})}catch(t){return Promise.reject(t)}},r}();(function(r){r[r.INITIALIZED=0]="INITIALIZED",r[r.LOADING=1]="LOADING",r[r.SUCCESS=2]="SUCCESS",r[r.FAILURE=3]="FAILURE"})(gt||(gt={}));var Be=function(r){function n(a){var h;a===void 0&&(a={}),(h=r.call(this,a)||this).searchUrl=void 0,h.reverseUrl=void 0;var t="https://nominatim.openstreetmap.org";return h.searchUrl=a.searchUrl||t+"/search",h.reverseUrl=a.reverseUrl||t+"/reverse",h}Pe(n,r);var o=n.prototype;return o.endpoint=function(a){var h=a.query,t=a.type,e=typeof h=="string"?{q:h}:h;return e.format="json",this.getUrl(t===et.REVERSE?this.reverseUrl:this.searchUrl,e)},o.parse=function(a){return(Array.isArray(a.data)?a.data:[a.data]).map(function(h){return{x:Number(h.lon),y:Number(h.lat),label:h.display_name,bounds:[[parseFloat(h.boundingbox[0]),parseFloat(h.boundingbox[2])],[parseFloat(h.boundingbox[1]),parseFloat(h.boundingbox[3])]],raw:h}})},n}(Ae),at={leafletAreaSelectorControl:"_37qQG",leafletMapOverlayPane:"_39tTo",drawPaneHelp:"_2Ftyt",endSelectionArea:"_3Xj9O",areaSelectMarker:"_1h_hk",areaSelectGhostMarker:"_1KD2U _1h_hk"};function Ge(r){return r.split("-").map(function(n,o){return o===0?n:""+n[0].toUpperCase()+n.substring(1)}).join("")}function O(r,n){n===void 0&&(n="");var o=Ge(r);return at[o]?n?at[o]+" "+r+" "+n:at[o]+" "+r:n?r+" "+n:r}function Re(r,n){n.parentNode.insertBefore(r,n.nextSibling)}function Et(r,n,o){o===void 0&&(o=null);var a=o?n.add(o):n;r._leaflet_pos=a,v.Browser.any3d?v.DomUtil.setTransform(r,a):(r.style.left=a.x+"px",r.style.top=a.y+"px")}var E=v.Browser.mobile?"touchend":"click";function dt(r){return r.isTrusted||window.Cypress}var j="area-draw-selection";function Ue(r){var n=r.active,o=r.fadeOnActivation,a=v.DomUtil.create("div",O("leaflet-map-overlay-pane","leaflet-pane"+(n?"":" inactive")+(o?" fading-enabled":"")));return a}function Te(r,n){var o=r.getContainer().querySelector(".leaflet-map-pane"),a=Ue(n);Re(a,o);var h=r.createPane(j,a),t=function(i){dt(i)&&(i.stopPropagation(),r.fire("as:point-add",i))};return h.addEventListener(E,t),h}function Ne(r,n){var o=n[0],a=n[1],h=r.getMap(),t=h.getPane(j),e=v.DomUtil.create("div",O("end-selection-area"),t),i=e.getBoundingClientRect();e.setAttribute("role","button");var s=function(c){dt(c)&&(c.stopPropagation(),h.fire("as:creation-end"))};e.addEventListener(E,s,{once:!0}),e.addEventListener("mouseenter",r.hoverClosePoint.bind(r)),e.addEventListener("mouseleave",r.outClosePoint.bind(r)),Et(e,new v.Point(o,a),new v.Point(-i.width/2,-i.height/2))}function xt(r){var n=r.getMap(),o=n.getPane(j),a=o.querySelector(".end-selection-area");a&&a.remove()}function G(){return G=Object.assign||function(r){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(r[a]=o[a])}return r},G.apply(this,arguments)}function De(r,n){if(r==null)return{};var o={},a=Object.keys(r),h,t;for(t=0;t<a.length;t++)h=a[t],!(n.indexOf(h)>=0)&&(o[h]=r[h]);return o}function z(r){r.originalEvent.preventDefault(),r.originalEvent.stopPropagation()}function D(r){var n=this;if(!this.mapMoving){var o=this.getMap(),a=r.clientX,h=r.clientY;if(a===void 0&&h===void 0){var t=r.changedTouches[0];a=t.clientX,h=t.clientY}if(this.rectDrawing&&this.rectDrawEnd!==null){o.fire("as:dragging-rect-end");return}var e=r.index,i=e===void 0?null:e,s=o.getContainer(),l=s.getBoundingClientRect(),c=a-l.left,u=h-l.top;this.markers.length===0&&Ne(this,[c,u]);var f=new v.Point(c,u),d=new v.DivIcon({className:O("area-select-marker"),iconSize:[16,16]}),p=new v.Marker(o.containerPointToLatLng(f),{icon:d,draggable:!0}),_=Ot.bind(this);p.on("drag",_(i===null?this.markers.length:i)),p.on("dragstart",function(C){C.target.getElement().classList.add("active")}),p.on("dragend",function(C){C.target.getElement().classList.remove("active"),requestAnimationFrame(function(){n.onPolygonReady()})});var y={marker:p,index:i};if(p.on("dblclick",function(C){return function(M){M.originalEvent.stopPropagation(),o.fire("as:marker-remove",G({},y,{index:i===null?C:i}))}}(this.markers.length)),p.on(E,z),p.addTo(o),o.fire("as:marker-add",y),i!==null)for(var g=function(M){n.markers[M].marker.off("drag"),n.markers[M].marker.on("drag",_(M)),n.markers[M].marker.off(E),n.markers[M].marker.on(E,z),n.markers[M].marker.off("dblclick"),n.markers[M].marker.on("dblclick",function(P){o.fire("as:marker-remove",G({},n.markers[M],{index:M}))})},k=i+1;k<this.markers.length;k++)g(k)}}function Ze(r){var n=r.index,o=n===void 0?null:n,a=De(r,["index"]),h=this.getMap(),t={marker:a.marker},e=this.markers;o===null?e.push(t):e.splice(o,0,t);var i=e.length>=3;this.phase==="draw"&&(i?e.length===3&&e.forEach(function(s,l){var c=s.marker,u=c.getIcon();u.options.className=O("area-select-marker",l===0?"start-marker":null),c.setIcon(u)}):e.forEach(function(s){var l=s.marker,c=l.getIcon();c.options.className=O("area-select-marker","invalid"),l.setIcon(c)})),h.fire("as:update-polygon"),this.phase==="adjust"&&(h.fire("as:update-ghost-points"),this.onPolygonReady()),this.phase==="draw"&&(this.closeLine&&h.removeLayer(this.closeLine),i&&(this.closeLine=new v.Polyline([e[0].marker.getLatLng(),e[e.length-1].marker.getLatLng()],{weight:3,color:"#c0c0c0",className:"areaCloseLine"}),h.addLayer(this.closeLine)))}function Fe(r){var n=this,o=r.index,a=o===void 0?0:o,h=this.getMap(),t=this.markers,e=t.length>3;if(e){var i=this.markers.splice(a||0,1);i[0].marker.removeFrom(h),h.fire("as:update-polygon"),this.phase==="adjust"&&h.fire("as:update-ghost-points");for(var s=function(u){n.markers[u].marker.off("drag"),n.markers[u].marker.on("drag",Ot.bind(n)(u)),n.markers[u].marker.off(E),n.markers[u].marker.on(E,z),n.markers[u].marker.off("dblclick"),n.markers[u].marker.on("dblclick",function(f){f.originalEvent.stopPropagation(),h.fire("as:marker-remove",G({},n.markers[u],{index:u}))})},l=a;l<this.markers.length;l++)s(l);this.onPolygonReady()}}function je(){var r=this,n=this.getMap(),o=this.markers,a=o.length>=3,h=new v.Polygon(o.map(function(t){var e=t.marker;return e.getLatLng()}),G({color:a?"rgb(45, 123, 200)":"rgba(220, 53, 69, 0.7)",weight:2},!a&&{dashArray:"5, 10"},{className:"drawing-area-poligon"}));h.on(E,function(t){v.DomEvent.stopPropagation(t)}),h.on("dblclick",function(t){return v.DomEvent.stopPropagation(t),r.onPolygonDblClick(t),!1}),this.polygon&&n.removeLayer(this.polygon),this.polygon=h,n.addLayer(this.polygon)}function ze(){var r=this,n=this.getMap();requestAnimationFrame(function(){r.clearGhostMarkers();var o=r.markers,a=r.ghostMarkers;o.forEach(function(h,t){var e=o[t+1]?o[t+1]:o[0],i=h.marker.getLatLng(),s=e.marker.getLatLng(),l=n.latLngToContainerPoint([(i.lat+s.lat)/2,(i.lng+s.lng)/2]),c=new v.DivIcon({className:O("area-select-ghost-marker"),iconSize:[16,16]}),u=new v.Marker(n.containerPointToLatLng(l),{icon:c,draggable:!0}),f={marker:u};u.on(E,z),u.on("dblclick",z),u.on("dragstart",Xe.bind(r)()),u.on("drag",Ve.bind(r)(a.length)),u.on("dragend",Ye.bind(r)(a.length)),a.push(f),u.addTo(n)})})}function He(){var r=this.getMap();r.dragging.enable(),r.removeLayer(this.closeLine),this.closeLine=null,this.markers[0].marker.getElement().classList.remove("start-marker"),this.setPhase("adjust"),r.fire("as:update-ghost-points"),this.onPolygonReady(),xt(this)}function qe(r){if(dt(r)){var n=this.getMap();this._dragStatus=n.dragging._enabled,r.stopPropagation(),r.target.blur();var o=this.options.active||this.phase==="adjust";o?(this._dragStatus||n.dragging.disable(),this.options.onButtonDeactivate(this.polygon,this,r),r.defaultPrevented||this.deactivate()):(this.options.onButtonActivate(this,r),r.defaultPrevented||this.activate())}}function Ot(r){var n=this.getMap();return function(o){requestAnimationFrame(function(){n.fire("as:update-polygon"),n.fire("as:update-ghost-points")})}}function Ve(r){var n=this,o=this.getMap();return function(a){var h=a.latlng;requestAnimationFrame(function(){var t=n.markers[r],e=n.markers[r+1]?n.markers[r+1]:n.markers[0];n.ghostPolygon&&o.removeLayer(n.ghostPolygon),n.ghostPolygon=new v.Polygon([t.marker.getLatLng(),h,e.marker.getLatLng()],{color:"rgb(45, 123, 200)",weight:2,opacity:.5,fillOpacity:.1,dashArray:"5, 10"}),o.addLayer(n.ghostPolygon),o.fire("as:update-polygon")})}}function Xe(){return function(r){r.target.getElement().classList.add("active")}}function Ye(r){var n=this,o=this.getMap();return function(a){var h=a.target;h.getElement().classList.remove("active"),h.removeFrom(o),n.ghostPolygon&&o.removeLayer(n.ghostPolygon);var t=o.latLngToContainerPoint(h.getLatLng()),e=o.getContainer(),i=e.getBoundingClientRect(),s={clientX:t.x+i.left,clientY:t.y+i.top,index:r+1};o.fire("as:point-add",s)}}function Ke(r){if(!this.mapMoving&&this.markers.length===0&&r.which!==0&&r.buttons===1){var n=this.getMap();if(!this.rectDrawing){this.rectDrawStart=[r.clientX,r.clientY];var o={weight:2,color:"#8B4513",className:"rect-progress-line",opacity:.6};this.draggingRect=new v.LayerGroup().addLayer(new v.Polyline([],o)).addLayer(new v.Polyline([],o)).addTo(n),this.rectDrawing=!0;return}this.rectDrawEnd=[r.clientX,r.clientY];var a=[this.rectDrawStart[0],r.clientY],h=[r.clientX,this.rectDrawStart[1]],t=this.draggingRect.getLayers();t[0].setLatLngs([n.mouseEventToLatLng({clientX:this.rectDrawEnd[0],clientY:this.rectDrawEnd[1]}),n.mouseEventToLatLng({clientX:a[0],clientY:a[1]}),n.mouseEventToLatLng({clientX:this.rectDrawStart[0],clientY:this.rectDrawStart[1]})]),t[1].setLatLngs([n.mouseEventToLatLng({clientX:this.rectDrawEnd[0],clientY:this.rectDrawEnd[1]}),n.mouseEventToLatLng({clientX:h[0],clientY:h[1]}),n.mouseEventToLatLng({clientX:this.rectDrawStart[0],clientY:this.rectDrawStart[1]})])}}function We(){this.rectDrawing=!1;var r={clientX:this.rectDrawStart[0],clientY:this.rectDrawStart[1]},n={clientX:this.rectDrawEnd[0],clientY:this.rectDrawStart[1]},o={clientX:this.rectDrawEnd[0],clientY:this.rectDrawEnd[1]},a={clientX:this.rectDrawStart[0],clientY:this.rectDrawEnd[1]};D.bind(this)(r),D.bind(this)(n),D.bind(this)(o),D.bind(this)(a),this._map.fire("as:creation-end"),this.rectDrawStart=null,this.rectDrawEnd=null,this.draggingRect.removeFrom(this._map)}var ft=v.Control.extend({options:{active:!1,fadeOnActivation:!0,onPolygonReady:function(n,o){},onPolygonDblClick:function(n,o,a){},onButtonActivate:function(n,o){},onButtonDeactivate:function(n,o,a){}},initialize:function(n){n===void 0&&(n={}),v.Util.setOptions(this,n),this._map=null,this.phase=n.active?"draw":"inactive",this.mapMoving=!1,this.rectDrawing=!1,this.rectDrawStart=null,this.rectDrawEnd=null,this.draggingRect=null,this.markers=[],this.ghostMarkers=[],this.polygon=null,this.closeLine=null,this._mapMoveStart=this._mapMoveStart.bind(this),this._mapMoveEnd=this._mapMoveEnd.bind(this),this._handleMouseMove=this._handleMouseMove.bind(this)},onAdd:function(n){this._container=v.DomUtil.create("div",O("leaflet-area-selector-control")),this.activateButton=v.DomUtil.create("button","",this._container),this.activateButton.setAttribute("aria-label","Draw shape"),this.activateButton.setAttribute("aria-describedby","draw-panel-help"),this.activateButton.addEventListener("click",qe.bind(this)),this.activateButton.addEventListener("dblclick",function(a){a.stopPropagation()}),this.options.active?this.activateButton.classList.add("active"):this.activateButton.classList.remove("active"),this._map=n;var o=Te(n,this.options);return this.addUserHelpPanel(o),n.getContainer().addEventListener("mousemove",this._handleMouseMove),n.on("movestart",this._mapMoveStart),n.on("moveend",this._mapMoveEnd),n.on("as:point-add",D.bind(this)),n.on("as:marker-add",Ze.bind(this)),n.on("as:marker-remove",Fe.bind(this)),n.on("as:creation-end",He.bind(this)),n.on("as:update-polygon",je.bind(this)),n.on("as:update-ghost-points",ze.bind(this)),n.on("as:dragging-rect-end",We.bind(this)),this._container},onRemove:function(n){n.getContainer().removeEventListener("mousemove",this._handleMouseMove),n.off("movestart",this._mapMoveStart),n.off("moveend",this._mapMoveEnd),n.off("as:point-add"),n.off("as:marker-add"),n.off("as:marker-remove"),n.off("as:creation-end"),n.off("as:update-polygon"),n.off("as:update-ghost-points"),n.off("as:dragging-rect-end")},getMap:function(){return this._map},onPolygonReady:function(){this.options.onPolygonReady(this.polygon,this)},onPolygonDblClick:function(n){this.options.onPolygonDblClick(this.polygon,this,n)},addUserHelpPanel:function(n){var o=v.DomUtil.create("div",O("draw-pane-help"));o.setAttribute("id","draw-panel-help"),o.setAttribute("role","tooltip");var a="Define a polygon by clicking of the map to define vertexes"+(v.Browser.mobile?".":" or click-and-drag to obtain a rectangular shape.");o.textContent=a,n.appendChild(o)},setPhase:function(n,o){o===void 0&&(o=!1),this.phase=n,this.options.active=n==="draw",(o||this.phase==="draw")&&(this.clearGhostMarkers(),this.clearMarkers(),this.clearPolygon());var a=this._map.getPane(j),h=a.parentNode;this.options.active?h.classList.remove("inactive"):h.classList.add("inactive")},_mapMoveStart:function(){this.options.active&&(this.mapMoving=!0)},_mapMoveEnd:function(){var n=this;if(this.options.active){var o=this._map;requestAnimationFrame(function(){n.mapMoving=!1});var a=o.getPane(j),h=a.querySelector(".end-selection-area");if(h){var t=this.markers[0].marker,e=h.getBoundingClientRect(),i=o.latLngToContainerPoint(t.getLatLng());Et(h,i,new v.Point(-e.width/2,-e.height/2))}}},hoverClosePoint:function(n){this.markers.length>2&&this.closeLine&&this.closeLine.removeFrom(this._map)},outClosePoint:function(n){this.closeLine&&this.closeLine.addTo(this._map)},clearMarkers:function(){var n=this;this.markers.forEach(function(o){var a=o.marker;a.removeFrom(n._map)}),this.markers=[]},clearGhostMarkers:function(){var n=this;this.ghostMarkers.forEach(function(o){var a=o.marker;a.removeFrom(n._map)}),this.ghostMarkers=[]},clearPolygon:function(){this.polygon&&this.polygon.removeFrom(this._map),this.polygon=null,this.closeLine&&this.closeLine.removeFrom(this._map),this.closeLine=null},deactivate:function(){xt(this),this.activateButton.classList.remove("active"),this._map.getContainer().classList.remove("drawing-area"),this.setPhase("inactive",!0)},activate:function(){this._map.dragging.disable(),this.activateButton.classList.add("active"),this._map.getContainer().classList.add("drawing-area"),this.setPhase("draw",!0)},_handleMouseMove:function(n){this.options.active&&Ke.bind(this)(n)}}),Qe=function(n){return n===void 0&&(n={}),new ft(n)};v.Util.extend(v.Control,{DrawAreaSelection:ft,drawAreaSelection:Qe});var vt={exports:{}};(function(r,n){(function(o,a){a(n)})(be,function(o){var a=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnEveryZoom:!1,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyShapePositions:null,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(t){L.Util.setOptions(this,t),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var e=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,e?this._withAnimation:this._noAnimation),this._markerCluster=e?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(t){if(t instanceof L.LayerGroup)return this.addLayers([t]);if(!t.getLatLng)return this._nonPointGroup.addLayer(t),this.fire("layeradd",{layer:t}),this;if(!this._map)return this._needsClustering.push(t),this.fire("layeradd",{layer:t}),this;if(this.hasLayer(t))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(t,this._maxZoom),this.fire("layeradd",{layer:t}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var e=t,i=this._zoom;if(t.__parent)for(;e.__parent._zoom>=i;)e=e.__parent;return this._currentShownBounds.contains(e.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(t,e):this._animationAddLayerNonAnimated(t,e)),this},removeLayer:function(t){return t instanceof L.LayerGroup?this.removeLayers([t]):t.getLatLng?this._map?t.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(t)),this._removeLayer(t,!0),this.fire("layerremove",{layer:t}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),t.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(t)&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,t)&&this.hasLayer(t)&&this._needsRemoving.push({layer:t,latlng:t._latlng}),this.fire("layerremove",{layer:t}),this):(this._nonPointGroup.removeLayer(t),this.fire("layerremove",{layer:t}),this)},addLayers:function(t,e){if(!L.Util.isArray(t))return this.addLayer(t);var i=this._featureGroup,s=this._nonPointGroup,l=this.options.chunkedLoading,c=this.options.chunkInterval,u=this.options.chunkProgress,f=t.length,d=0,p=!0,_;if(this._map){var y=new Date().getTime(),g=L.bind(function(){var C=new Date().getTime();for(this._map&&this._unspiderfy&&this._unspiderfy();d<f;d++){if(l&&d%200===0){var M=new Date().getTime()-C;if(M>c)break}if(_=t[d],_ instanceof L.LayerGroup){p&&(t=t.slice(),p=!1),this._extractNonGroupLayers(_,t),f=t.length;continue}if(!_.getLatLng){s.addLayer(_),e||this.fire("layeradd",{layer:_});continue}if(!this.hasLayer(_)&&(this._addLayer(_,this._maxZoom),e||this.fire("layeradd",{layer:_}),_.__parent&&_.__parent.getChildCount()===2)){var P=_.__parent.getAllChildMarkers(),nt=P[0]===_?P[1]:P[0];i.removeLayer(nt)}}u&&u(d,f,new Date().getTime()-y),d===f?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(g,this.options.chunkDelay)},this);g()}else for(var k=this._needsClustering;d<f;d++){if(_=t[d],_ instanceof L.LayerGroup){p&&(t=t.slice(),p=!1),this._extractNonGroupLayers(_,t),f=t.length;continue}if(!_.getLatLng){s.addLayer(_);continue}this.hasLayer(_)||k.push(_)}return this},removeLayers:function(t){var e,i,s=t.length,l=this._featureGroup,c=this._nonPointGroup,u=!0;if(!this._map){for(e=0;e<s;e++){if(i=t[e],i instanceof L.LayerGroup){u&&(t=t.slice(),u=!1),this._extractNonGroupLayers(i,t),s=t.length;continue}this._arraySplice(this._needsClustering,i),c.removeLayer(i),this.hasLayer(i)&&this._needsRemoving.push({layer:i,latlng:i._latlng}),this.fire("layerremove",{layer:i})}return this}if(this._unspiderfy){this._unspiderfy();var f=t.slice(),d=s;for(e=0;e<d;e++){if(i=f[e],i instanceof L.LayerGroup){this._extractNonGroupLayers(i,f),d=f.length;continue}this._unspiderfyLayer(i)}}for(e=0;e<s;e++){if(i=t[e],i instanceof L.LayerGroup){u&&(t=t.slice(),u=!1),this._extractNonGroupLayers(i,t),s=t.length;continue}if(!i.__parent){c.removeLayer(i),this.fire("layerremove",{layer:i});continue}this._removeLayer(i,!0,!0),this.fire("layerremove",{layer:i}),l.hasLayer(i)&&(l.removeLayer(i),i.clusterShow&&i.clusterShow())}return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(t){t.off(this._childMarkerEventHandlers,this),delete t.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var t=new L.LatLngBounds;this._topClusterLevel&&t.extend(this._topClusterLevel._bounds);for(var e=this._needsClustering.length-1;e>=0;e--)t.extend(this._needsClustering[e].getLatLng());return t.extend(this._nonPointGroup.getBounds()),t},eachLayer:function(t,e){var i=this._needsClustering.slice(),s=this._needsRemoving,l,c,u;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(i),c=i.length-1;c>=0;c--){for(l=!0,u=s.length-1;u>=0;u--)if(s[u].layer===i[c]){l=!1;break}l&&t.call(e,i[c])}this._nonPointGroup.eachLayer(t,e)},getLayers:function(){var t=[];return this.eachLayer(function(e){t.push(e)}),t},getLayer:function(t){var e=null;return t=parseInt(t,10),this.eachLayer(function(i){L.stamp(i)===t&&(e=i)}),e},hasLayer:function(t){if(!t)return!1;var e,i=this._needsClustering;for(e=i.length-1;e>=0;e--)if(i[e]===t)return!0;for(i=this._needsRemoving,e=i.length-1;e>=0;e--)if(i[e].layer===t)return!1;return!!(t.__parent&&t.__parent._group===this)||this._nonPointGroup.hasLayer(t)},zoomToShowLayer:function(t,e){var i=this._map;typeof e!="function"&&(e=function(){});var s=function(){(i.hasLayer(t)||i.hasLayer(t.__parent))&&!this._inZoomAnimation&&(this._map.off("moveend",s,this),this.off("animationend",s,this),i.hasLayer(t)?e():t.__parent._icon&&(this.once("spiderfied",e,this),t.__parent.spiderfy()))};t._icon&&this._map.getBounds().contains(t.getLatLng())?e():t.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",s,this),this._map.panTo(t.getLatLng())):(this._map.on("moveend",s,this),this.on("animationend",s,this),t.__parent.zoomToBounds())},onAdd:function(t){this._map=t;var e,i,s;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(t),this._nonPointGroup.addTo(t),this._gridClusters||this._generateInitialClusters(),this._maxLat=t.options.crs.projection.MAX_LATITUDE,e=0,i=this._needsRemoving.length;e<i;e++)s=this._needsRemoving[e],s.newlatlng=s.layer._latlng,s.layer._latlng=s.latlng;for(e=0,i=this._needsRemoving.length;e<i;e++)s=this._needsRemoving[e],this._removeLayer(s.layer,!0),s.layer._latlng=s.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),i=this._needsClustering,this._needsClustering=[],this.addLayers(i,!0)},onRemove:function(t){t.off("zoomend",this._zoomEnd,this),t.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(t){for(var e=t;e&&!e._icon;)e=e.__parent;return e||null},_arraySplice:function(t,e){for(var i=t.length-1;i>=0;i--)if(t[i]===e)return t.splice(i,1),!0},_removeFromGridUnclustered:function(t,e){for(var i=this._map,s=this._gridUnclustered,l=Math.floor(this._map.getMinZoom());e>=l&&s[e].removeObject(t,i.project(t.getLatLng(),e));e--);},_childMarkerDragStart:function(t){t.target.__dragStart=t.target._latlng},_childMarkerMoved:function(t){if(!this._ignoreMove&&!t.target.__dragStart){var e=t.target._popup&&t.target._popup.isOpen();this._moveChild(t.target,t.oldLatLng,t.latlng),e&&t.target.openPopup()}},_moveChild:function(t,e,i){t._latlng=e,this.removeLayer(t),t._latlng=i,this.addLayer(t)},_childMarkerDragEnd:function(t){var e=t.target.__dragStart;delete t.target.__dragStart,e&&this._moveChild(t.target,e,t.target._latlng)},_removeLayer:function(t,e,i){var s=this._gridClusters,l=this._gridUnclustered,c=this._featureGroup,u=this._map,f=Math.floor(this._map.getMinZoom());e&&this._removeFromGridUnclustered(t,this._maxZoom);var d=t.__parent,p=d._markers,_;for(this._arraySplice(p,t);d&&(d._childCount--,d._boundsNeedUpdate=!0,!(d._zoom<f));)e&&d._childCount<=1?(_=d._markers[0]===t?d._markers[1]:d._markers[0],s[d._zoom].removeObject(d,u.project(d._cLatLng,d._zoom)),l[d._zoom].addObject(_,u.project(_.getLatLng(),d._zoom)),this._arraySplice(d.__parent._childClusters,d),d.__parent._markers.push(_),_.__parent=d.__parent,d._icon&&(c.removeLayer(d),i||c.addLayer(_))):d._iconNeedsUpdate=!0,d=d.__parent;delete t.__parent},_isOrIsParent:function(t,e){for(;e;){if(t===e)return!0;e=e.parentNode}return!1},fire:function(t,e,i){if(e&&e.layer instanceof L.MarkerCluster){if(e.originalEvent&&this._isOrIsParent(e.layer._icon,e.originalEvent.relatedTarget))return;t="cluster"+t}L.FeatureGroup.prototype.fire.call(this,t,e,i)},listens:function(t,e){return L.FeatureGroup.prototype.listens.call(this,t,e)||L.FeatureGroup.prototype.listens.call(this,"cluster"+t,e)},_defaultIconCreateFunction:function(t){var e=t.getChildCount(),i=" marker-cluster-";return e<10?i+="small":e<100?i+="medium":i+="large",new L.DivIcon({html:"<div><span>"+e+"</span></div>",className:"marker-cluster"+i,iconSize:new L.Point(40,40)})},_bindEvents:function(){var t=this._map,e=this.options.spiderfyOnMaxZoom,i=this.options.showCoverageOnHover,s=this.options.zoomToBoundsOnClick,l=this.options.spiderfyOnEveryZoom;(e||s||l)&&this.on("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),i&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),t.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(t){var e=t.layer,i=e;if(!(t.type==="clusterkeypress"&&t.originalEvent&&t.originalEvent.keyCode!==13)){for(;i._childClusters.length===1;)i=i._childClusters[0];i._zoom===this._maxZoom&&i._childCount===e._childCount&&this.options.spiderfyOnMaxZoom?e.spiderfy():this.options.zoomToBoundsOnClick&&e.zoomToBounds(),this.options.spiderfyOnEveryZoom&&e.spiderfy(),t.originalEvent&&t.originalEvent.keyCode===13&&this._map._container.focus()}},_showCoverage:function(t){var e=this._map;this._inZoomAnimation||(this._shownPolygon&&e.removeLayer(this._shownPolygon),t.layer.getChildCount()>2&&t.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(t.layer.getConvexHull(),this.options.polygonOptions),e.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var t=this.options.spiderfyOnMaxZoom,e=this.options.showCoverageOnHover,i=this.options.zoomToBoundsOnClick,s=this.options.spiderfyOnEveryZoom,l=this._map;(t||i||s)&&this.off("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),e&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),l.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var t=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),t),this._currentShownBounds=t}},_generateInitialClusters:function(){var t=Math.ceil(this._map.getMaxZoom()),e=Math.floor(this._map.getMinZoom()),i=this.options.maxClusterRadius,s=i;typeof i!="function"&&(s=function(){return i}),this.options.disableClusteringAtZoom!==null&&(t=this.options.disableClusteringAtZoom-1),this._maxZoom=t,this._gridClusters={},this._gridUnclustered={};for(var l=t;l>=e;l--)this._gridClusters[l]=new L.DistanceGrid(s(l)),this._gridUnclustered[l]=new L.DistanceGrid(s(l));this._topClusterLevel=new this._markerCluster(this,e-1)},_addLayer:function(t,e){var i=this._gridClusters,s=this._gridUnclustered,l=Math.floor(this._map.getMinZoom()),c,u;for(this.options.singleMarkerMode&&this._overrideMarkerIcon(t),t.on(this._childMarkerEventHandlers,this);e>=l;e--){c=this._map.project(t.getLatLng(),e);var f=i[e].getNearObject(c);if(f){f._addChild(t),t.__parent=f;return}if(f=s[e].getNearObject(c),f){var d=f.__parent;d&&this._removeLayer(f,!1);var p=new this._markerCluster(this,e,f,t);i[e].addObject(p,this._map.project(p._cLatLng,e)),f.__parent=p,t.__parent=p;var _=p;for(u=e-1;u>d._zoom;u--)_=new this._markerCluster(this,u,_),i[u].addObject(_,this._map.project(f.getLatLng(),u));d._addChild(_),this._removeFromGridUnclustered(f,e);return}s[e].addObject(t,c)}this._topClusterLevel._addChild(t),t.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(t){t instanceof L.MarkerCluster&&t._iconNeedsUpdate&&t._updateIcon()})},_enqueue:function(t){this._queue.push(t),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var t=0;t<this._queue.length;t++)this._queue[t].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var t=Math.round(this._map._zoom);this._processQueue(),this._zoom<t&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,t)):this._zoom>t?(this._animationStart(),this._animationZoomOut(this._zoom,t)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(this.options.removeOutsideVisibleBounds){if(L.Browser.mobile)return this._checkBoundsMaxLat(this._map.getBounds())}else return this._mapBoundsInfinite;return this._checkBoundsMaxLat(this._map.getBounds().pad(1))},_checkBoundsMaxLat:function(t){var e=this._maxLat;return e!==void 0&&(t.getNorth()>=e&&(t._northEast.lat=1/0),t.getSouth()<=-e&&(t._southWest.lat=-1/0)),t},_animationAddLayerNonAnimated:function(t,e){if(e===t)this._featureGroup.addLayer(t);else if(e._childCount===2){e._addToMap();var i=e.getAllChildMarkers();this._featureGroup.removeLayer(i[0]),this._featureGroup.removeLayer(i[1])}else e._updateIcon()},_extractNonGroupLayers:function(t,e){var i=t.getLayers(),s=0,l;for(e=e||[];s<i.length;s++){if(l=i[s],l instanceof L.LayerGroup){this._extractNonGroupLayers(l,e);continue}e.push(l)}return e},_overrideMarkerIcon:function(t){var e=t.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[t]}});return e}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(t,e){this._animationAddLayerNonAnimated(t,e)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(t,e){var i=this._getExpandedVisibleBounds(),s=this._featureGroup,l=Math.floor(this._map.getMinZoom()),c;this._ignoreMove=!0,this._topClusterLevel._recursively(i,t,l,function(u){var f=u._latlng,d=u._markers,p;for(i.contains(f)||(f=null),u._isSingleParent()&&t+1===e?(s.removeLayer(u),u._recursivelyAddChildrenToMap(null,e,i)):(u.clusterHide(),u._recursivelyAddChildrenToMap(f,e,i)),c=d.length-1;c>=0;c--)p=d[c],i.contains(p._latlng)||s.removeLayer(p)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(i,e),s.eachLayer(function(u){!(u instanceof L.MarkerCluster)&&u._icon&&u.clusterShow()}),this._topClusterLevel._recursively(i,t,e,function(u){u._recursivelyRestoreChildPositions(e)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(i,t,l,function(u){s.removeLayer(u),u.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(t,e){this._animationZoomOutSingle(this._topClusterLevel,t-1,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t,this._getExpandedVisibleBounds())},_animationAddLayer:function(t,e){var i=this,s=this._featureGroup;s.addLayer(t),e!==t&&(e._childCount>2?(e._updateIcon(),this._forceLayout(),this._animationStart(),t._setPos(this._map.latLngToLayerPoint(e.getLatLng())),t.clusterHide(),this._enqueue(function(){s.removeLayer(t),t.clusterShow(),i._animationEnd()})):(this._forceLayout(),i._animationStart(),i._animationZoomOutSingle(e,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(t,e,i){var s=this._getExpandedVisibleBounds(),l=Math.floor(this._map.getMinZoom());t._recursivelyAnimateChildrenInAndAddSelfToMap(s,l,e+1,i);var c=this;this._forceLayout(),t._recursivelyBecomeVisible(s,i),this._enqueue(function(){if(t._childCount===1){var u=t._markers[0];this._ignoreMove=!0,u.setLatLng(u.getLatLng()),this._ignoreMove=!1,u.clusterShow&&u.clusterShow()}else t._recursively(s,i,l,function(f){f._recursivelyRemoveChildrenFromMap(s,l,e+1)});c._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}),L.markerClusterGroup=function(t){return new L.MarkerClusterGroup(t)};var h=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(t,e,i,s){L.Marker.prototype.initialize.call(this,i?i._cLatLng||i.getLatLng():new L.LatLng(0,0),{icon:this,pane:t.options.clusterPane}),this._group=t,this._zoom=e,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,i&&this._addChild(i),s&&this._addChild(s)},getAllChildMarkers:function(t,e){t=t||[];for(var i=this._childClusters.length-1;i>=0;i--)this._childClusters[i].getAllChildMarkers(t,e);for(var s=this._markers.length-1;s>=0;s--)e&&this._markers[s].__dragStart||t.push(this._markers[s]);return t},getChildCount:function(){return this._childCount},zoomToBounds:function(t){for(var e=this._childClusters.slice(),i=this._group._map,s=i.getBoundsZoom(this._bounds),l=this._zoom+1,c=i.getZoom(),u;e.length>0&&s>l;){l++;var f=[];for(u=0;u<e.length;u++)f=f.concat(e[u]._childClusters);e=f}s>l?this._group._map.setView(this._latlng,l):s<=c?this._group._map.setView(this._latlng,c+1):this._group._map.fitBounds(this._bounds,t)},getBounds:function(){var t=new L.LatLngBounds;return t.extend(this._bounds),t},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(t,e){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(t),t instanceof L.MarkerCluster?(e||(this._childClusters.push(t),t.__parent=this),this._childCount+=t._childCount):(e||this._markers.push(t),this._childCount++),this.__parent&&this.__parent._addChild(t,!0)},_setClusterCenter:function(t){this._cLatLng||(this._cLatLng=t._cLatLng||t._latlng)},_resetBounds:function(){var t=this._bounds;t._southWest&&(t._southWest.lat=1/0,t._southWest.lng=1/0),t._northEast&&(t._northEast.lat=-1/0,t._northEast.lng=-1/0)},_recalculateBounds:function(){var t=this._markers,e=this._childClusters,i=0,s=0,l=this._childCount,c,u,f,d;if(l!==0){for(this._resetBounds(),c=0;c<t.length;c++)f=t[c]._latlng,this._bounds.extend(f),i+=f.lat,s+=f.lng;for(c=0;c<e.length;c++)u=e[c],u._boundsNeedUpdate&&u._recalculateBounds(),this._bounds.extend(u._bounds),f=u._wLatLng,d=u._childCount,i+=f.lat*d,s+=f.lng*d;this._latlng=this._wLatLng=new L.LatLng(i/l,s/l),this._boundsNeedUpdate=!1}},_addToMap:function(t){t&&(this._backupLatlng=this._latlng,this.setLatLng(t)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(t,e,i){this._recursively(t,this._group._map.getMinZoom(),i-1,function(s){var l=s._markers,c,u;for(c=l.length-1;c>=0;c--)u=l[c],u._icon&&(u._setPos(e),u.clusterHide())},function(s){var l=s._childClusters,c,u;for(c=l.length-1;c>=0;c--)u=l[c],u._icon&&(u._setPos(e),u.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(t,e,i,s){this._recursively(t,s,e,function(l){l._recursivelyAnimateChildrenIn(t,l._group._map.latLngToLayerPoint(l.getLatLng()).round(),i),l._isSingleParent()&&i-1===s?(l.clusterShow(),l._recursivelyRemoveChildrenFromMap(t,e,i)):l.clusterHide(),l._addToMap()})},_recursivelyBecomeVisible:function(t,e){this._recursively(t,this._group._map.getMinZoom(),e,null,function(i){i.clusterShow()})},_recursivelyAddChildrenToMap:function(t,e,i){this._recursively(i,this._group._map.getMinZoom()-1,e,function(s){if(e!==s._zoom)for(var l=s._markers.length-1;l>=0;l--){var c=s._markers[l];i.contains(c._latlng)&&(t&&(c._backupLatlng=c.getLatLng(),c.setLatLng(t),c.clusterHide&&c.clusterHide()),s._group._featureGroup.addLayer(c))}},function(s){s._addToMap(t)})},_recursivelyRestoreChildPositions:function(t){for(var e=this._markers.length-1;e>=0;e--){var i=this._markers[e];i._backupLatlng&&(i.setLatLng(i._backupLatlng),delete i._backupLatlng)}if(t-1===this._zoom)for(var s=this._childClusters.length-1;s>=0;s--)this._childClusters[s]._restorePosition();else for(var l=this._childClusters.length-1;l>=0;l--)this._childClusters[l]._recursivelyRestoreChildPositions(t)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(t,e,i,s){var l,c;this._recursively(t,e-1,i-1,function(u){for(c=u._markers.length-1;c>=0;c--)l=u._markers[c],(!s||!s.contains(l._latlng))&&(u._group._featureGroup.removeLayer(l),l.clusterShow&&l.clusterShow())},function(u){for(c=u._childClusters.length-1;c>=0;c--)l=u._childClusters[c],(!s||!s.contains(l._latlng))&&(u._group._featureGroup.removeLayer(l),l.clusterShow&&l.clusterShow())})},_recursively:function(t,e,i,s,l){var c=this._childClusters,u=this._zoom,f,d;if(e<=u&&(s&&s(this),l&&u===i&&l(this)),u<e||u<i)for(f=c.length-1;f>=0;f--)d=c[f],d._boundsNeedUpdate&&d._recalculateBounds(),t.intersects(d._bounds)&&d._recursively(t,e,i,s,l)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){var t=this.options.opacity;return this.setOpacity(0),this.options.opacity=t,this},clusterShow:function(){return this.setOpacity(this.options.opacity)}}),L.DistanceGrid=function(t){this._cellSize=t,this._sqCellSize=t*t,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(t,e){var i=this._getCoord(e.x),s=this._getCoord(e.y),l=this._grid,c=l[s]=l[s]||{},u=c[i]=c[i]||[],f=L.Util.stamp(t);this._objectPoint[f]=e,u.push(t)},updateObject:function(t,e){this.removeObject(t),this.addObject(t,e)},removeObject:function(t,e){var i=this._getCoord(e.x),s=this._getCoord(e.y),l=this._grid,c=l[s]=l[s]||{},u=c[i]=c[i]||[],f,d;for(delete this._objectPoint[L.Util.stamp(t)],f=0,d=u.length;f<d;f++)if(u[f]===t)return u.splice(f,1),d===1&&delete c[i],!0},eachObject:function(t,e){var i,s,l,c,u,f,d,p=this._grid;for(i in p){u=p[i];for(s in u)for(f=u[s],l=0,c=f.length;l<c;l++)d=t.call(e,f[l]),d&&(l--,c--)}},getNearObject:function(t){var e=this._getCoord(t.x),i=this._getCoord(t.y),s,l,c,u,f,d,p,_,y=this._objectPoint,g=this._sqCellSize,k=null;for(s=i-1;s<=i+1;s++)if(u=this._grid[s],u){for(l=e-1;l<=e+1;l++)if(f=u[l],f)for(c=0,d=f.length;c<d;c++)p=f[c],_=this._sqDist(y[L.Util.stamp(p)],t),(_<g||_<=g&&k===null)&&(g=_,k=p)}return k},_getCoord:function(t){var e=Math.floor(t/this._cellSize);return isFinite(e)?e:t},_sqDist:function(t,e){var i=e.x-t.x,s=e.y-t.y;return i*i+s*s}},function(){L.QuickHull={getDistant:function(t,e){var i=e[1].lat-e[0].lat,s=e[0].lng-e[1].lng;return s*(t.lat-e[0].lat)+i*(t.lng-e[0].lng)},findMostDistantPointFromBaseLine:function(t,e){var i=0,s=null,l=[],c,u,f;for(c=e.length-1;c>=0;c--){if(u=e[c],f=this.getDistant(u,t),f>0)l.push(u);else continue;f>i&&(i=f,s=u)}return{maxPoint:s,newPoints:l}},buildConvexHull:function(t,e){var i=[],s=this.findMostDistantPointFromBaseLine(t,e);return s.maxPoint?(i=i.concat(this.buildConvexHull([t[0],s.maxPoint],s.newPoints)),i=i.concat(this.buildConvexHull([s.maxPoint,t[1]],s.newPoints)),i):[t[0]]},getConvexHull:function(t){var e=!1,i=!1,s=!1,l=!1,c=null,u=null,f=null,d=null,p=null,_=null,y;for(y=t.length-1;y>=0;y--){var g=t[y];(e===!1||g.lat>e)&&(c=g,e=g.lat),(i===!1||g.lat<i)&&(u=g,i=g.lat),(s===!1||g.lng>s)&&(f=g,s=g.lng),(l===!1||g.lng<l)&&(d=g,l=g.lng)}i!==e?(_=u,p=c):(_=d,p=f);var k=[].concat(this.buildConvexHull([_,p],t),this.buildConvexHull([p,_],t));return k}}}(),L.MarkerCluster.include({getConvexHull:function(){var t=this.getAllChildMarkers(),e=[],i,s;for(s=t.length-1;s>=0;s--)i=t[s].getLatLng(),e.push(i);return L.QuickHull.getConvexHull(e)}}),L.MarkerCluster.include({_2PI:Math.PI*2,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(!(this._group._spiderfied===this||this._group._inZoomAnimation)){var t=this.getAllChildMarkers(null,!0),e=this._group,i=e._map,s=i.latLngToLayerPoint(this._latlng),l;this._group._unspiderfy(),this._group._spiderfied=this,this._group.options.spiderfyShapePositions?l=this._group.options.spiderfyShapePositions(t.length,s):t.length>=this._circleSpiralSwitchover?l=this._generatePointsSpiral(t.length,s):(s.y+=10,l=this._generatePointsCircle(t.length,s)),this._animationSpiderfy(t,l)}},unspiderfy:function(t){this._group._inZoomAnimation||(this._animationUnspiderfy(t),this._group._spiderfied=null)},_generatePointsCircle:function(t,e){var i=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+t),s=i/this._2PI,l=this._2PI/t,c=[],u,f;for(s=Math.max(s,35),c.length=t,u=0;u<t;u++)f=this._circleStartAngle+u*l,c[u]=new L.Point(e.x+s*Math.cos(f),e.y+s*Math.sin(f))._round();return c},_generatePointsSpiral:function(t,e){var i=this._group.options.spiderfyDistanceMultiplier,s=i*this._spiralLengthStart,l=i*this._spiralFootSeparation,c=i*this._spiralLengthFactor*this._2PI,u=0,f=[],d;for(f.length=t,d=t;d>=0;d--)d<t&&(f[d]=new L.Point(e.x+s*Math.cos(u),e.y+s*Math.sin(u))._round()),u+=l/s+d*5e-4,s+=c/u;return f},_noanimationUnspiderfy:function(){var t=this._group,e=t._map,i=t._featureGroup,s=this.getAllChildMarkers(null,!0),l,c;for(t._ignoreMove=!0,this.setOpacity(1),c=s.length-1;c>=0;c--)l=s[c],i.removeLayer(l),l._preSpiderfyLatlng&&(l.setLatLng(l._preSpiderfyLatlng),delete l._preSpiderfyLatlng),l.setZIndexOffset&&l.setZIndexOffset(0),l._spiderLeg&&(e.removeLayer(l._spiderLeg),delete l._spiderLeg);t.fire("unspiderfied",{cluster:this,markers:s}),t._ignoreMove=!1,t._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(t,e){var i=this._group,s=i._map,l=i._featureGroup,c=this._group.options.spiderLegPolylineOptions,u,f,d,p;for(i._ignoreMove=!0,u=0;u<t.length;u++)p=s.layerPointToLatLng(e[u]),f=t[u],d=new L.Polyline([this._latlng,p],c),s.addLayer(d),f._spiderLeg=d,f._preSpiderfyLatlng=f._latlng,f.setLatLng(p),f.setZIndexOffset&&f.setZIndexOffset(1e6),l.addLayer(f);this.setOpacity(.3),i._ignoreMove=!1,i.fire("spiderfied",{cluster:this,markers:t})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(t,e){var i=this,s=this._group,l=s._map,c=s._featureGroup,u=this._latlng,f=l.latLngToLayerPoint(u),d=L.Path.SVG,p=L.extend({},this._group.options.spiderLegPolylineOptions),_=p.opacity,y,g,k,C,M,P;for(_===void 0&&(_=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),d?(p.opacity=0,p.className=(p.className||"")+" leaflet-cluster-spider-leg"):p.opacity=_,s._ignoreMove=!0,y=0;y<t.length;y++)g=t[y],P=l.layerPointToLatLng(e[y]),k=new L.Polyline([u,P],p),l.addLayer(k),g._spiderLeg=k,d&&(C=k._path,M=C.getTotalLength()+.1,C.style.strokeDasharray=M,C.style.strokeDashoffset=M),g.setZIndexOffset&&g.setZIndexOffset(1e6),g.clusterHide&&g.clusterHide(),c.addLayer(g),g._setPos&&g._setPos(f);for(s._forceLayout(),s._animationStart(),y=t.length-1;y>=0;y--)P=l.layerPointToLatLng(e[y]),g=t[y],g._preSpiderfyLatlng=g._latlng,g.setLatLng(P),g.clusterShow&&g.clusterShow(),d&&(k=g._spiderLeg,C=k._path,C.style.strokeDashoffset=0,k.setStyle({opacity:_}));this.setOpacity(.3),s._ignoreMove=!1,setTimeout(function(){s._animationEnd(),s.fire("spiderfied",{cluster:i,markers:t})},200)},_animationUnspiderfy:function(t){var e=this,i=this._group,s=i._map,l=i._featureGroup,c=t?s._latLngToNewLayerPoint(this._latlng,t.zoom,t.center):s.latLngToLayerPoint(this._latlng),u=this.getAllChildMarkers(null,!0),f=L.Path.SVG,d,p,_,y,g,k;for(i._ignoreMove=!0,i._animationStart(),this.setOpacity(1),p=u.length-1;p>=0;p--)d=u[p],d._preSpiderfyLatlng&&(d.closePopup(),d.setLatLng(d._preSpiderfyLatlng),delete d._preSpiderfyLatlng,k=!0,d._setPos&&(d._setPos(c),k=!1),d.clusterHide&&(d.clusterHide(),k=!1),k&&l.removeLayer(d),f&&(_=d._spiderLeg,y=_._path,g=y.getTotalLength()+.1,y.style.strokeDashoffset=g,_.setStyle({opacity:0})));i._ignoreMove=!1,setTimeout(function(){var C=0;for(p=u.length-1;p>=0;p--)d=u[p],d._spiderLeg&&C++;for(p=u.length-1;p>=0;p--)d=u[p],d._spiderLeg&&(d.clusterShow&&d.clusterShow(),d.setZIndexOffset&&d.setZIndexOffset(0),C>1&&l.removeLayer(d),s.removeLayer(d._spiderLeg),delete d._spiderLeg);i._animationEnd(),i.fire("unspiderfied",{cluster:e,markers:u})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(t){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(t))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(t){this._spiderfied&&this._spiderfied.unspiderfy(t)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(t){t._spiderLeg&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow(),t.setZIndexOffset&&t.setZIndexOffset(0),this._map.removeLayer(t._spiderLeg),delete t._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(t){return t?t instanceof L.MarkerClusterGroup?t=t._topClusterLevel.getAllChildMarkers():t instanceof L.LayerGroup?t=t._layers:t instanceof L.MarkerCluster?t=t.getAllChildMarkers():t instanceof L.Marker&&(t=[t]):t=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(t),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(t),this},_flagParentsIconsNeedUpdate:function(t){var e,i;for(e in t)for(i=t[e].__parent;i;)i._iconNeedsUpdate=!0,i=i.__parent},_refreshSingleMarkerModeMarkers:function(t){var e,i;for(e in t)i=t[e],this.hasLayer(i)&&i.setIcon(this._overrideMarkerIcon(i))}}),L.Marker.include({refreshIconOptions:function(t,e){var i=this.options.icon;return L.setOptions(i,t),this.setIcon(i),e&&this.__parent&&this.__parent._group.refreshClusters(this),this}}),o.MarkerClusterGroup=a,o.MarkerCluster=h,Object.defineProperty(o,"__esModule",{value:!0})})})(vt,vt.exports);let Z=[],I=null;const Je=r=>{Z.length&&Z.forEach(n=>{n.removeEventListener("click")}),I&&r.removeLayer(I),Z=[]},$e=r=>{const n=K(ht),o=K(yt),{id:a,spotStatus:h,img:t,title:e,videoLink:i,user:s,publicBanner:{banner:l,bannerUrl:c},location:{lat:u,lng:f}}=r;Nt.set({...r,status:h,img:{src:t,title:e||a},video:i,firm:{banner:l,bannerUrl:c},coords:{lat:u,lng:f}}),n("/@:username/spot/:id",{username:s.username,id:a}),o||(document.getElementById("highlighted").innerHTML="")},ti=r=>{const{id:n,location:{lat:o,lng:a},icon:h,thumbnail:t}=r,e=F.marker([o,a],{icon:ve(h||t,n)});return e.addEventListener("click",()=>$e(r)),e.spotId=n,e},ei=(r,n)=>{const{center:{lat:o,lng:a},spotcnt:h}=r,t=F.marker([o,a],{icon:Le(h)});return t.addEventListener("click",()=>n.setView([o,a],14)),t},ii=(r,n,o)=>{var h,t;I=F.markerClusterGroup({chunkedLoading:!0,spiderfyOnMaxZoom:!1,showCoverageOnHover:!1,iconCreateFunction:ge});const a=[];if((h=n==null?void 0:n.spots)==null||h.forEach(e=>{var s;const i=ti(e);i.isAdditionalCategory=(s=K(Gt).find(l=>l.id===e.categoryId))==null?void 0:s.isAdditional,I.addLayer(i),Z.push(i),a.push(i)}),(t=n==null?void 0:n.clusters)==null||t.forEach(e=>{const i=ei(e,r);i.count=e.spotcnt,I.addLayer(i),Z.push(i),a.push(i)}),I.on("clusterclick",e=>{if(e.layer._zoom===Rt){const i=K(ht),s=e.layer.getAllChildMarkers(),l=n==null?void 0:n.spots.filter(c=>s.some(u=>u.spotId===c.id));Ut.set(l),i("/selected-spots")}}),r.addLayer(I),o){const e=new F.featureGroup(a);r.fitBounds(e.getBounds())}window.dispatchEvent(Tt)},Lt=(r,n,o)=>{var a,h;Je(r),(((a=n==null?void 0:n.spots)==null?void 0:a.length)>0||((h=n==null?void 0:n.clusters)==null?void 0:h.length)>0)&&ii(r,n,o)};function ni(r){let n;return{c(){n=bt("div"),n.innerHTML='<div class="train svelte-1a70k6t"><div class="windows svelte-1a70k6t"></div> <div class="lights svelte-1a70k6t"></div></div> <div class="rails svelte-1a70k6t"><div class="ties svelte-1a70k6t"></div> <div class="ties svelte-1a70k6t"></div> <div class="ties svelte-1a70k6t"></div></div>',Pt(n,"class","loader svelte-1a70k6t")},m(o,a){W(o,n,a)},p:X,i:X,o:X,d(o){o&&Q(n)}}}class ri extends kt{constructor(n){super(),Ct(this,n,null,ni,Mt,{})}}const{window:oi}=me;function si(r){let n,o,a,h,t;const e=r[8].default,i=Kt(e,r,r[7],null);return{c(){n=bt("div"),o=Wt(),i&&i.c(),Pt(n,"class","map svelte-d2benj"),V(n,"add-mode",r[1]),V(n,"area-selection-mode",r[2])},m(s,l){W(s,n,l),W(s,o,l),i&&i.m(s,l),a=!0,h||(t=Qt(r[3].call(null,n)),h=!0)},p(s,l){(!a||l&2)&&V(n,"add-mode",s[1]),(!a||l&4)&&V(n,"area-selection-mode",s[2]),i&&i.p&&(!a||l&128)&&Jt(i,e,s,s[7],a?te(e,s[7],l,null):$t(s[7]),null)},i(s){a||($(i,s),a=!0)},o(s){J(i,s),a=!1},d(s){s&&(Q(n),Q(o)),i&&i.d(s),h=!1,t()}}}function ai(r){let n,o;return n=new ri({}),{c(){ee(n.$$.fragment)},m(a,h){ie(n,a,h),o=!0},p:X,i(a){o||($(n.$$.fragment,a),o=!0)},o(a){J(n.$$.fragment,a),o=!1},d(a){ne(n,a)}}}function li(r){let n,o,a,h,t,e;const i=[ai,si],s=[];function l(c,u){return c[0]?0:1}return n=l(r),o=s[n]=i[n](r),{c(){o.c(),a=Dt()},m(c,u){s[n].m(c,u),W(c,a,u),h=!0,t||(e=Zt(oi,"resize",qt),t=!0)},p(c,[u]){let f=n;n=l(c),n===f?s[n].p(c,u):(Vt(),J(s[f],1,1,()=>{s[f]=null}),Ft(),o=s[n],o?o.p(c,u):(o=s[n]=i[n](c),o.c()),$(o,1),o.m(a.parentNode,a))},i(c){h||($(o),h=!0)},o(c){J(o),h=!1},d(c){c&&Q(a),s[n].d(c),t=!1,e()}}}function ui(r,n,o){let a,h,t,e,i,s,l,c,u,f,d,p,_,y,g,k,C;b(r,re,m=>o(4,a=m)),b(r,oe,m=>o(5,h=m)),b(r,ot,m=>o(6,t=m)),b(r,_t,m=>o(9,e=m)),b(r,pt,m=>o(10,i=m)),b(r,se,m=>o(11,s=m)),b(r,ae,m=>o(12,l=m)),b(r,le,m=>o(13,c=m)),b(r,ue,m=>o(14,u=m)),b(r,he,m=>o(15,f=m)),b(r,ce,m=>o(16,d=m)),b(r,T,m=>o(17,p=m)),b(r,de,m=>o(18,_=m)),b(r,fe,m=>o(19,y=m)),b(r,pe,m=>o(0,g=m)),b(r,_e,m=>o(1,k=m)),b(r,yt,m=>o(2,C=m));let{$$slots:M={},$$scope:P}=n;ht.set(y),_(m=>{console.log("event",m),console.log("window.history",window.history);const{type:x,state:R,target:U}=m,{currentIndex:H,history:q}=p;if(console.log("$browserHistory",p),x==="pushstate"){const{pathname:Bt}=window.location.pathname,rt={...R,pathname:Bt};switch(T.setCurrentIndex(H),T.setEventType(x),R.id){case"___username_index":rt.profileState=d;break;case"_search":rt.searchState=f;break}T.pushToHistory(rt,H+1)}return x==="popstate"&&(console.log("target.location",U.location),T.setEventType(x)),!0}),u(m=>{console.log("data",m),jt.set(!0)});let nt=zt("categories")||[1];pt.set(new ft({onPolygonReady:m=>{Ht.set(!0),m.setStyle({color:"var(--color-accent)",weight:4,fillOpacity:.18});const{coordinates:x}=m.toGeoJSON().geometry;Me(x[0])},position:"bottomright"}));const It=new Be;_t.set(new Ie({provider:It,position:"topright",style:"button",showMarker:!1,searchLabel:"Search",maxSuggestions:Xt()?3:5,autoClose:!0}));const At=m=>{var R;const x=nt.includes(2)?[mt,ye]:[mt];return ot.set(F.map(m,{layers:x})),t.zoomControl.setPosition("bottomleft"),c.length>0?(t.fitBounds(c),(R=h==null?void 0:h.spots)!=null&&R.length&&Lt(t,h,a)):ke(t),t.on("moveend",()=>l&&Ce(t)),t.on("zoomend",()=>Yt.set(t.getZoom())),document.addEventListener("click",U=>{if(s){const H=document.querySelector(".geosearch"),q=document.querySelector(".search-artist");!H.contains(U.target)&&!(q!=null&&q.contains(U.target))&&e.close(),U.target.classList.contains("item")&&e.clearResults()}}),t.addControl(i),t.addControl(e),{destroy:()=>{t.remove(),ot.set(null)}}};return r.$$set=m=>{"$$scope"in m&&o(7,P=m.$$scope)},r.$$.update=()=>{r.$$.dirty&112&&t&&h&&Lt(t,h,a)},[g,k,C,At,a,h,t,P,M]}class ki extends kt{constructor(n){super(),Ct(this,n,ui,li,Mt,{})}}export{ki as default};
