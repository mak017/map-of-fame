import{v as z,a6 as xt,a7 as Ot,a8 as ot,a9 as Bt,aa as At,ab as mt,ac as It,S as vt,i as Lt,s as yt,I as kt,K as Ct,b as H,M as F,l as q,e as Gt,ad as Rt,t as V,f as Ut,h as X,T as b,ae as Nt,af as Dt,ag as ht,ah as Tt,ai as ct,$ as Zt,g as Ft,aj as jt,ak as tt,al as zt,p as Ht,H as qt,am as Z,Q as Vt,u as Xt,q as Yt,r as Wt,a as Kt,m as Qt,d as Jt,an as $t,ao as te,ap as ee,a4 as ie,aq as ne,ar as re,as as oe,at as se,au as ae,a1 as le,av as ue}from"./index-b97375a6.js";import{g as he}from"./globals-7f7f1b26.js";import{t as st,l as v,L as N,c as ce,m as de,a as fe,o as dt,b as pe}from"./icons-a9f81fc2.js";import{n as ft,s as _e,h as ge}from"./locationUtils-908a6b12.js";import{a as me}from"./init-36a9a4f8.js";import{c as ve}from"./_commonjsHelpers-725317a4.js";import"./datesUtils-b7e6e6ca.js";import"./auth-42cd4e99.js";import"./endpoints-5fb45e2d.js";import"./spot-444f4e46.js";import"./transformers-2ad5cf36.js";function B(){return B=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(r[a]=s[a])}return r},B.apply(this,arguments)}function Le(r,n){r.prototype=Object.create(n.prototype),r.prototype.constructor=r,Y(r,n)}function Y(r,n){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,a){return s.__proto__=a,s},Y(r,n)}function ye(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function nt(r,n,s){return nt=ye()?Reflect.construct.bind():function(a,c,t){var e=[null];e.push.apply(e,c);var i=new(Function.bind.apply(a,e));return t&&Y(i,t.prototype),i},nt.apply(null,arguments)}function S(r,n,s,a){n===void 0&&(n=""),a===void 0&&(a={});var c=document.createElement(r);return n&&(c.className=n),Object.keys(a).forEach(function(t){if(typeof a[t]=="function"){var e=t.indexOf("on")===0?t.substr(2).toLowerCase():t;c.addEventListener(e,a[t])}else t==="html"?c.innerHTML=a[t]:t==="text"?c.innerText=a[t]:c.setAttribute(t,a[t])}),s&&s.appendChild(c),c}function G(r){r.preventDefault(),r.stopPropagation()}var j=function(){return[].slice.call(arguments).filter(Boolean).join(" ").trim()};function A(r,n){r&&r.classList&&(Array.isArray(n)?n:[n]).forEach(function(s){r.classList.contains(s)||r.classList.add(s)})}function w(r,n){r&&r.classList&&(Array.isArray(n)?n:[n]).forEach(function(s){r.classList.contains(s)&&r.classList.remove(s)})}var W,K=13,rt=40,Mt=38,ke=[K,27,rt,Mt,37,39],Ce=function(){function r(s){var a=this,c=s.handleSubmit,t=s.searchLabel,e=s.classNames,i=e===void 0?{}:e;this.container=void 0,this.form=void 0,this.input=void 0,this.handleSubmit=void 0,this.hasError=!1,this.container=S("div",j("geosearch",i.container)),this.form=S("form",["",i.form].join(" "),this.container,{autocomplete:"none",onClick:G,onDblClick:G,touchStart:G,touchEnd:G}),this.input=S("input",["glass",i.input].join(" "),this.form,{type:"text",placeholder:t||"search",onInput:this.onInput,onKeyUp:function(o){return a.onKeyUp(o)},onKeyPress:function(o){return a.onKeyPress(o)},onFocus:this.onFocus,onBlur:this.onBlur,onClick:function(){a.input.focus(),a.input.dispatchEvent(new Event("focus"))}}),this.handleSubmit=c}var n=r.prototype;return n.onFocus=function(){A(this.form,"active")},n.onBlur=function(){w(this.form,"active")},n.onSubmit=function(s){try{var a=this;return G(s),w(c=a.container,"error"),A(c,"pending"),Promise.resolve(a.handleSubmit({query:a.input.value})).then(function(){w(a.container,"pending")})}catch(t){return Promise.reject(t)}var c},n.onInput=function(){this.hasError&&(w(this.container,"error"),this.hasError=!1)},n.onKeyUp=function(s){s.keyCode===27&&(w(this.container,["pending","active"]),this.input.value="",document.body.focus(),document.body.blur())},n.onKeyPress=function(s){s.keyCode===K&&this.onSubmit(s)},n.setQuery=function(s){this.input.value=s},r}(),Me=function(){function r(s){var a=this,c=s.handleClick,t=s.classNames,e=t===void 0?{}:t,i=s.notFoundMessage;this.handleClick=void 0,this.selected=-1,this.results=[],this.container=void 0,this.resultItem=void 0,this.notFoundMessage=void 0,this.onClick=function(o){if(typeof a.handleClick=="function"){var l=o.target;if(l&&a.container.contains(l)&&l.hasAttribute("data-key")){var h=Number(l.getAttribute("data-key"));a.clear(),a.handleClick({result:a.results[h]})}}},this.handleClick=c,this.notFoundMessage=i?S("div",j(e.notfound),void 0,{html:i}):void 0,this.container=S("div",j("results",e.resultlist)),this.container.addEventListener("click",this.onClick,!0),this.resultItem=S("div",j(e.item))}var n=r.prototype;return n.render=function(s,a){var c=this;s===void 0&&(s=[]),this.clear(),s.forEach(function(t,e){var i=c.resultItem.cloneNode(!0);i.setAttribute("data-key",""+e),i.innerHTML=a({result:t}),c.container.appendChild(i)}),s.length>0?(A(this.container.parentElement,"open"),A(this.container,"active")):this.notFoundMessage&&(this.container.appendChild(this.notFoundMessage),A(this.container.parentElement,"open")),this.results=s},n.select=function(s){return Array.from(this.container.children).forEach(function(a,c){return c===s?A(a,"active"):w(a,"active")}),this.selected=s,this.results[s]},n.count=function(){return this.results?this.results.length:0},n.clear=function(){for(this.selected=-1;this.container.lastChild;)this.container.removeChild(this.container.lastChild);w(this.container.parentElement,"open"),w(this.container,"active")},r}(),et={position:"topleft",style:"button",showMarker:!0,showPopup:!1,popupFormat:function(r){return""+r.result.label},resultFormat:function(r){return""+r.result.label},marker:{icon:st&&v.Icon?new v.Icon.Default:void 0,draggable:!1},maxMarkers:1,maxSuggestions:5,retainZoomLevel:!1,animateZoom:!0,searchLabel:"Enter address",clearSearchLabel:"Clear search",notFoundMessage:"",messageHideDelay:3e3,zoomLevel:18,classNames:{container:"leaflet-bar leaflet-control leaflet-control-geosearch",button:"leaflet-bar-part leaflet-bar-part-single",resetButton:"reset",msgbox:"leaflet-bar message",form:"",input:"",resultlist:"",item:"",notfound:"leaflet-bar-notfound"},autoComplete:!0,autoCompleteDelay:250,autoClose:!1,keepResult:!1,updateMap:!0},bt="Leaflet must be loaded before instantiating the GeoSearch control",be={options:B({},et),classNames:B({},et.classNames),initialize:function(r){var n,s,a,c,t=this;if(!st)throw new Error(bt);if(!r.provider)throw new Error("Provider is missing from options");this.options=B({},et,r),this.classNames=B({},this.classNames,r.classNames),this.markers=new v.FeatureGroup,this.classNames.container+=" leaflet-geosearch-"+this.options.style,this.searchElement=new Ce({searchLabel:this.options.searchLabel,classNames:{container:this.classNames.container,form:this.classNames.form,input:this.classNames.input},handleSubmit:function(e){return t.onSubmit(e)}}),this.button=S("a",this.classNames.button,this.searchElement.container,{title:this.options.searchLabel,href:"#",onClick:function(e){return t.onClick(e)}}),v.DomEvent.disableClickPropagation(this.button),this.resetButton=S("button",this.classNames.resetButton,this.searchElement.form,{text:"Ã—","aria-label":this.options.clearSearchLabel,onClick:function(){t.searchElement.input.value===""?t.close():t.clearResults(null,!0)}}),v.DomEvent.disableClickPropagation(this.resetButton),this.options.autoComplete&&(this.resultList=new Me({handleClick:function(e){var i=e.result;t.searchElement.input.value=i.label,t.onSubmit({query:i.label,data:i})},classNames:{resultlist:this.classNames.resultlist,item:this.classNames.item,notfound:this.classNames.notfound},notFoundMessage:this.options.notFoundMessage}),this.searchElement.form.appendChild(this.resultList.container),this.searchElement.input.addEventListener("keyup",(n=function(e){return t.autoSearch(e)},(s=this.options.autoCompleteDelay)===void 0&&(s=250),a===void 0&&(a=!1),function(){var e=[].slice.call(arguments);c&&clearTimeout(c),c=setTimeout(function(){c=null,a||n.apply(void 0,e)},s),a&&!c&&n.apply(void 0,e)}),!0),this.searchElement.input.addEventListener("keydown",function(e){return t.selectResult(e)},!0),this.searchElement.input.addEventListener("keydown",function(e){return t.clearResults(e,!0)},!0)),this.searchElement.form.addEventListener("click",function(e){e.preventDefault()},!1)},onAdd:function(r){var n=this.options,s=n.showMarker,a=n.style;if(this.map=r,s&&this.markers.addTo(r),a==="bar"){var c=r.getContainer().querySelector(".leaflet-control-container");this.container=S("div","leaflet-control-geosearch leaflet-geosearch-bar"),this.container.appendChild(this.searchElement.form),c.appendChild(this.container)}return v.DomEvent.disableClickPropagation(this.searchElement.form),this.searchElement.container},onRemove:function(){var r;return(r=this.container)==null||r.remove(),this},open:function(){var r=this.searchElement,n=r.input;A(r.container,"active"),n.focus()},close:function(){w(this.searchElement.container,"active"),this.clearResults()},onClick:function(r){r.preventDefault(),r.stopPropagation(),this.searchElement.container.classList.contains("active")?this.close():this.open()},selectResult:function(r){if([K,rt,Mt].indexOf(r.keyCode)!==-1)if(r.preventDefault(),r.keyCode!==K){var n=this.resultList.count()-1;if(!(n<0)){var s=this.resultList.selected,a=r.keyCode===rt?s+1:s-1,c=this.resultList.select(a<0?n:a>n?0:a);this.searchElement.input.value=c.label}}else{var t=this.resultList.select(this.resultList.selected);this.onSubmit({query:this.searchElement.input.value,data:t})}},clearResults:function(r,n){if(n===void 0&&(n=!1),!r||r.keyCode===27){var s=this.options,a=s.autoComplete;!n&&s.keepResult||(this.searchElement.input.value="",this.markers.clearLayers()),a&&this.resultList.clear()}},autoSearch:function(r){try{var n=this;if(ke.indexOf(r.keyCode)>-1)return Promise.resolve();var s=r.target.value,a=n.options.provider,c=function(){if(s.length)return Promise.resolve(a.search({query:s})).then(function(t){t=t.slice(0,n.options.maxSuggestions),n.resultList.render(t,n.options.resultFormat)});n.resultList.clear()}();return Promise.resolve(c&&c.then?c.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},onSubmit:function(r){try{var n=this;return Promise.resolve(n.options.provider.search(r)).then(function(s){s&&s.length>0&&n.showResult(s[0],r)})}catch(s){return Promise.reject(s)}},showResult:function(r,n){var s=this.options,a=s.autoClose,c=s.updateMap,t=this.markers.getLayers();t.length>=this.options.maxMarkers&&this.markers.removeLayer(t[0]);var e=this.addMarker(r,n);c&&this.centerMap(r),this.map.fireEvent("geosearch/showlocation",{location:r,marker:e}),a&&this.closeResults()},closeResults:function(){var r=this.searchElement.container;r.classList.contains("active")&&w(r,"active"),this.clearResults()},addMarker:function(r,n){var s=this,a=this.options,c=a.marker,t=a.showPopup,e=a.popupFormat,i=new v.Marker([r.y,r.x],c),o=r.label;return typeof e=="function"&&(o=e({query:n,result:r})),i.bindPopup(o),this.markers.addLayer(i),t&&i.openPopup(),c.draggable&&i.on("dragend",function(l){s.map.fireEvent("geosearch/marker/dragend",{location:i.getLatLng(),event:l})}),i},centerMap:function(r){var n=this.options,s=n.retainZoomLevel,a=n.animateZoom,c=r.bounds?new v.LatLngBounds(r.bounds):new v.LatLng(r.y,r.x).toBounds(10),t=c.isValid()?c:this.markers.getBounds();!s&&c.isValid()&&!r.bounds||s||!c.isValid()?this.map.setView(t.getCenter(),this.getZoom(),{animate:a}):this.map.fitBounds(t,{animate:a})},getZoom:function(){var r=this.options,n=r.zoomLevel;return r.retainZoomLevel?this.map.getZoom():n}};function Pe(){if(!st)throw new Error(bt);var r=v.Control.extend(be);return nt(r,[].slice.call(arguments))}(function(r){r[r.SEARCH=0]="SEARCH",r[r.REVERSE=1]="REVERSE"})(W||(W={}));var pt,we=function(){function r(s){s===void 0&&(s={}),this.options=void 0,this.options=s}var n=r.prototype;return n.getParamString=function(s){s===void 0&&(s={});var a=B({},this.options.params,s);return Object.keys(a).map(function(c){return encodeURIComponent(c)+"="+encodeURIComponent(a[c])}).join("&")},n.getUrl=function(s,a){return s+"?"+this.getParamString(a)},n.search=function(s){try{var a=this,c=a.endpoint({query:s.query,type:W.SEARCH});return Promise.resolve(fetch(c)).then(function(t){return Promise.resolve(t.json()).then(function(e){return a.parse({data:e})})})}catch(t){return Promise.reject(t)}},r}();(function(r){r[r.INITIALIZED=0]="INITIALIZED",r[r.LOADING=1]="LOADING",r[r.SUCCESS=2]="SUCCESS",r[r.FAILURE=3]="FAILURE"})(pt||(pt={}));var Se=function(r){function n(a){var c;a===void 0&&(a={}),(c=r.call(this,a)||this).searchUrl=void 0,c.reverseUrl=void 0;var t="https://nominatim.openstreetmap.org";return c.searchUrl=a.searchUrl||t+"/search",c.reverseUrl=a.reverseUrl||t+"/reverse",c}Le(n,r);var s=n.prototype;return s.endpoint=function(a){var c=a.query,t=a.type,e=typeof c=="string"?{q:c}:c;return e.format="json",this.getUrl(t===W.REVERSE?this.reverseUrl:this.searchUrl,e)},s.parse=function(a){return(Array.isArray(a.data)?a.data:[a.data]).map(function(c){return{x:Number(c.lon),y:Number(c.lat),label:c.display_name,bounds:[[parseFloat(c.boundingbox[0]),parseFloat(c.boundingbox[2])],[parseFloat(c.boundingbox[1]),parseFloat(c.boundingbox[3])]],raw:c}})},n}(we),it={leafletAreaSelectorControl:"_37qQG",leafletMapOverlayPane:"_39tTo",drawPaneHelp:"_2Ftyt",endSelectionArea:"_3Xj9O",areaSelectMarker:"_1h_hk",areaSelectGhostMarker:"_1KD2U _1h_hk"};function Ee(r){return r.split("-").map(function(n,s){return s===0?n:""+n[0].toUpperCase()+n.substring(1)}).join("")}function x(r,n){n===void 0&&(n="");var s=Ee(r);return it[s]?n?it[s]+" "+r+" "+n:it[s]+" "+r:n?r+" "+n:r}function xe(r,n){n.parentNode.insertBefore(r,n.nextSibling)}function Pt(r,n,s){s===void 0&&(s=null);var a=s?n.add(s):n;r._leaflet_pos=a,v.Browser.any3d?v.DomUtil.setTransform(r,a):(r.style.left=a.x+"px",r.style.top=a.y+"px")}var E=v.Browser.mobile?"touchend":"click";function at(r){return r.isTrusted||window.Cypress}var D="area-draw-selection";function Oe(r){var n=r.active,s=r.fadeOnActivation,a=v.DomUtil.create("div",x("leaflet-map-overlay-pane","leaflet-pane"+(n?"":" inactive")+(s?" fading-enabled":"")));return a}function Be(r,n){var s=r.getContainer().querySelector(".leaflet-map-pane"),a=Oe(n);xe(a,s);var c=r.createPane(D,a),t=function(i){at(i)&&(i.stopPropagation(),r.fire("as:point-add",i))};return c.addEventListener(E,t),c}function Ae(r,n){var s=n[0],a=n[1],c=r.getMap(),t=c.getPane(D),e=v.DomUtil.create("div",x("end-selection-area"),t),i=e.getBoundingClientRect();e.setAttribute("role","button");var o=function(h){at(h)&&(h.stopPropagation(),c.fire("as:creation-end"))};e.addEventListener(E,o,{once:!0}),e.addEventListener("mouseenter",r.hoverClosePoint.bind(r)),e.addEventListener("mouseleave",r.outClosePoint.bind(r)),Pt(e,new v.Point(s,a),new v.Point(-i.width/2,-i.height/2))}function wt(r){var n=r.getMap(),s=n.getPane(D),a=s.querySelector(".end-selection-area");a&&a.remove()}function I(){return I=Object.assign||function(r){for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(r[a]=s[a])}return r},I.apply(this,arguments)}function Ie(r,n){if(r==null)return{};var s={},a=Object.keys(r),c,t;for(t=0;t<a.length;t++)c=a[t],!(n.indexOf(c)>=0)&&(s[c]=r[c]);return s}function T(r){r.originalEvent.preventDefault(),r.originalEvent.stopPropagation()}function R(r){var n=this;if(!this.mapMoving){var s=this.getMap(),a=r.clientX,c=r.clientY;if(a===void 0&&c===void 0){var t=r.changedTouches[0];a=t.clientX,c=t.clientY}if(this.rectDrawing&&this.rectDrawEnd!==null){s.fire("as:dragging-rect-end");return}var e=r.index,i=e===void 0?null:e,o=s.getContainer(),l=o.getBoundingClientRect(),h=a-l.left,u=c-l.top;this.markers.length===0&&Ae(this,[h,u]);var f=new v.Point(h,u),d=new v.DivIcon({className:x("area-select-marker"),iconSize:[16,16]}),p=new v.Marker(s.containerPointToLatLng(f),{icon:d,draggable:!0}),_=St.bind(this);p.on("drag",_(i===null?this.markers.length:i)),p.on("dragstart",function(C){C.target.getElement().classList.add("active")}),p.on("dragend",function(C){C.target.getElement().classList.remove("active"),requestAnimationFrame(function(){n.onPolygonReady()})});var y={marker:p,index:i};if(p.on("dblclick",function(C){return function(M){M.originalEvent.stopPropagation(),s.fire("as:marker-remove",I({},y,{index:i===null?C:i}))}}(this.markers.length)),p.on(E,T),p.addTo(s),s.fire("as:marker-add",y),i!==null)for(var m=function(M){n.markers[M].marker.off("drag"),n.markers[M].marker.on("drag",_(M)),n.markers[M].marker.off(E),n.markers[M].marker.on(E,T),n.markers[M].marker.off("dblclick"),n.markers[M].marker.on("dblclick",function(P){s.fire("as:marker-remove",I({},n.markers[M],{index:M}))})},k=i+1;k<this.markers.length;k++)m(k)}}function Ge(r){var n=r.index,s=n===void 0?null:n,a=Ie(r,["index"]),c=this.getMap(),t={marker:a.marker},e=this.markers;s===null?e.push(t):e.splice(s,0,t);var i=e.length>=3;this.phase==="draw"&&(i?e.length===3&&e.forEach(function(o,l){var h=o.marker,u=h.getIcon();u.options.className=x("area-select-marker",l===0?"start-marker":null),h.setIcon(u)}):e.forEach(function(o){var l=o.marker,h=l.getIcon();h.options.className=x("area-select-marker","invalid"),l.setIcon(h)})),c.fire("as:update-polygon"),this.phase==="adjust"&&(c.fire("as:update-ghost-points"),this.onPolygonReady()),this.phase==="draw"&&(this.closeLine&&c.removeLayer(this.closeLine),i&&(this.closeLine=new v.Polyline([e[0].marker.getLatLng(),e[e.length-1].marker.getLatLng()],{weight:3,color:"#c0c0c0",className:"areaCloseLine"}),c.addLayer(this.closeLine)))}function Re(r){var n=this,s=r.index,a=s===void 0?0:s,c=this.getMap(),t=this.markers,e=t.length>3;if(e){var i=this.markers.splice(a||0,1);i[0].marker.removeFrom(c),c.fire("as:update-polygon"),this.phase==="adjust"&&c.fire("as:update-ghost-points");for(var o=function(u){n.markers[u].marker.off("drag"),n.markers[u].marker.on("drag",St.bind(n)(u)),n.markers[u].marker.off(E),n.markers[u].marker.on(E,T),n.markers[u].marker.off("dblclick"),n.markers[u].marker.on("dblclick",function(f){f.originalEvent.stopPropagation(),c.fire("as:marker-remove",I({},n.markers[u],{index:u}))})},l=a;l<this.markers.length;l++)o(l);this.onPolygonReady()}}function Ue(){var r=this,n=this.getMap(),s=this.markers,a=s.length>=3,c=new v.Polygon(s.map(function(t){var e=t.marker;return e.getLatLng()}),I({color:a?"rgb(45, 123, 200)":"rgba(220, 53, 69, 0.7)",weight:2},!a&&{dashArray:"5, 10"},{className:"drawing-area-poligon"}));c.on(E,function(t){v.DomEvent.stopPropagation(t)}),c.on("dblclick",function(t){return v.DomEvent.stopPropagation(t),r.onPolygonDblClick(t),!1}),this.polygon&&n.removeLayer(this.polygon),this.polygon=c,n.addLayer(this.polygon)}function Ne(){var r=this,n=this.getMap();requestAnimationFrame(function(){r.clearGhostMarkers();var s=r.markers,a=r.ghostMarkers;s.forEach(function(c,t){var e=s[t+1]?s[t+1]:s[0],i=c.marker.getLatLng(),o=e.marker.getLatLng(),l=n.latLngToContainerPoint([(i.lat+o.lat)/2,(i.lng+o.lng)/2]),h=new v.DivIcon({className:x("area-select-ghost-marker"),iconSize:[16,16]}),u=new v.Marker(n.containerPointToLatLng(l),{icon:h,draggable:!0}),f={marker:u};u.on(E,T),u.on("dblclick",T),u.on("dragstart",Fe.bind(r)()),u.on("drag",Ze.bind(r)(a.length)),u.on("dragend",je.bind(r)(a.length)),a.push(f),u.addTo(n)})})}function De(){var r=this.getMap();r.dragging.enable(),r.removeLayer(this.closeLine),this.closeLine=null,this.markers[0].marker.getElement().classList.remove("start-marker"),this.setPhase("adjust"),r.fire("as:update-ghost-points"),this.onPolygonReady(),wt(this)}function Te(r){if(at(r)){var n=this.getMap();this._dragStatus=n.dragging._enabled,r.stopPropagation(),r.target.blur();var s=this.options.active||this.phase==="adjust";s?(this._dragStatus||n.dragging.disable(),this.options.onButtonDeactivate(this.polygon,this,r),r.defaultPrevented||this.deactivate()):(this.options.onButtonActivate(this,r),r.defaultPrevented||this.activate())}}function St(r){var n=this.getMap();return function(s){requestAnimationFrame(function(){n.fire("as:update-polygon"),n.fire("as:update-ghost-points")})}}function Ze(r){var n=this,s=this.getMap();return function(a){var c=a.latlng;requestAnimationFrame(function(){var t=n.markers[r],e=n.markers[r+1]?n.markers[r+1]:n.markers[0];n.ghostPolygon&&s.removeLayer(n.ghostPolygon),n.ghostPolygon=new v.Polygon([t.marker.getLatLng(),c,e.marker.getLatLng()],{color:"rgb(45, 123, 200)",weight:2,opacity:.5,fillOpacity:.1,dashArray:"5, 10"}),s.addLayer(n.ghostPolygon),s.fire("as:update-polygon")})}}function Fe(){return function(r){r.target.getElement().classList.add("active")}}function je(r){var n=this,s=this.getMap();return function(a){var c=a.target;c.getElement().classList.remove("active"),c.removeFrom(s),n.ghostPolygon&&s.removeLayer(n.ghostPolygon);var t=s.latLngToContainerPoint(c.getLatLng()),e=s.getContainer(),i=e.getBoundingClientRect(),o={clientX:t.x+i.left,clientY:t.y+i.top,index:r+1};s.fire("as:point-add",o)}}function ze(r){if(!this.mapMoving&&this.markers.length===0&&r.which!==0&&r.buttons===1){var n=this.getMap();if(!this.rectDrawing){this.rectDrawStart=[r.clientX,r.clientY];var s={weight:2,color:"#8B4513",className:"rect-progress-line",opacity:.6};this.draggingRect=new v.LayerGroup().addLayer(new v.Polyline([],s)).addLayer(new v.Polyline([],s)).addTo(n),this.rectDrawing=!0;return}this.rectDrawEnd=[r.clientX,r.clientY];var a=[this.rectDrawStart[0],r.clientY],c=[r.clientX,this.rectDrawStart[1]],t=this.draggingRect.getLayers();t[0].setLatLngs([n.mouseEventToLatLng({clientX:this.rectDrawEnd[0],clientY:this.rectDrawEnd[1]}),n.mouseEventToLatLng({clientX:a[0],clientY:a[1]}),n.mouseEventToLatLng({clientX:this.rectDrawStart[0],clientY:this.rectDrawStart[1]})]),t[1].setLatLngs([n.mouseEventToLatLng({clientX:this.rectDrawEnd[0],clientY:this.rectDrawEnd[1]}),n.mouseEventToLatLng({clientX:c[0],clientY:c[1]}),n.mouseEventToLatLng({clientX:this.rectDrawStart[0],clientY:this.rectDrawStart[1]})])}}function He(){this.rectDrawing=!1;var r={clientX:this.rectDrawStart[0],clientY:this.rectDrawStart[1]},n={clientX:this.rectDrawEnd[0],clientY:this.rectDrawStart[1]},s={clientX:this.rectDrawEnd[0],clientY:this.rectDrawEnd[1]},a={clientX:this.rectDrawStart[0],clientY:this.rectDrawEnd[1]};R.bind(this)(r),R.bind(this)(n),R.bind(this)(s),R.bind(this)(a),this._map.fire("as:creation-end"),this.rectDrawStart=null,this.rectDrawEnd=null,this.draggingRect.removeFrom(this._map)}var lt=v.Control.extend({options:{active:!1,fadeOnActivation:!0,onPolygonReady:function(n,s){},onPolygonDblClick:function(n,s,a){},onButtonActivate:function(n,s){},onButtonDeactivate:function(n,s,a){}},initialize:function(n){n===void 0&&(n={}),v.Util.setOptions(this,n),this._map=null,this.phase=n.active?"draw":"inactive",this.mapMoving=!1,this.rectDrawing=!1,this.rectDrawStart=null,this.rectDrawEnd=null,this.draggingRect=null,this.markers=[],this.ghostMarkers=[],this.polygon=null,this.closeLine=null,this._mapMoveStart=this._mapMoveStart.bind(this),this._mapMoveEnd=this._mapMoveEnd.bind(this),this._handleMouseMove=this._handleMouseMove.bind(this)},onAdd:function(n){this._container=v.DomUtil.create("div",x("leaflet-area-selector-control")),this.activateButton=v.DomUtil.create("button","",this._container),this.activateButton.setAttribute("aria-label","Draw shape"),this.activateButton.setAttribute("aria-describedby","draw-panel-help"),this.activateButton.addEventListener("click",Te.bind(this)),this.activateButton.addEventListener("dblclick",function(a){a.stopPropagation()}),this.options.active?this.activateButton.classList.add("active"):this.activateButton.classList.remove("active"),this._map=n;var s=Be(n,this.options);return this.addUserHelpPanel(s),n.getContainer().addEventListener("mousemove",this._handleMouseMove),n.on("movestart",this._mapMoveStart),n.on("moveend",this._mapMoveEnd),n.on("as:point-add",R.bind(this)),n.on("as:marker-add",Ge.bind(this)),n.on("as:marker-remove",Re.bind(this)),n.on("as:creation-end",De.bind(this)),n.on("as:update-polygon",Ue.bind(this)),n.on("as:update-ghost-points",Ne.bind(this)),n.on("as:dragging-rect-end",He.bind(this)),this._container},onRemove:function(n){n.getContainer().removeEventListener("mousemove",this._handleMouseMove),n.off("movestart",this._mapMoveStart),n.off("moveend",this._mapMoveEnd),n.off("as:point-add"),n.off("as:marker-add"),n.off("as:marker-remove"),n.off("as:creation-end"),n.off("as:update-polygon"),n.off("as:update-ghost-points"),n.off("as:dragging-rect-end")},getMap:function(){return this._map},onPolygonReady:function(){this.options.onPolygonReady(this.polygon,this)},onPolygonDblClick:function(n){this.options.onPolygonDblClick(this.polygon,this,n)},addUserHelpPanel:function(n){var s=v.DomUtil.create("div",x("draw-pane-help"));s.setAttribute("id","draw-panel-help"),s.setAttribute("role","tooltip");var a="Define a polygon by clicking of the map to define vertexes"+(v.Browser.mobile?".":" or click-and-drag to obtain a rectangular shape.");s.textContent=a,n.appendChild(s)},setPhase:function(n,s){s===void 0&&(s=!1),this.phase=n,this.options.active=n==="draw",(s||this.phase==="draw")&&(this.clearGhostMarkers(),this.clearMarkers(),this.clearPolygon());var a=this._map.getPane(D),c=a.parentNode;this.options.active?c.classList.remove("inactive"):c.classList.add("inactive")},_mapMoveStart:function(){this.options.active&&(this.mapMoving=!0)},_mapMoveEnd:function(){var n=this;if(this.options.active){var s=this._map;requestAnimationFrame(function(){n.mapMoving=!1});var a=s.getPane(D),c=a.querySelector(".end-selection-area");if(c){var t=this.markers[0].marker,e=c.getBoundingClientRect(),i=s.latLngToContainerPoint(t.getLatLng());Pt(c,i,new v.Point(-e.width/2,-e.height/2))}}},hoverClosePoint:function(n){this.markers.length>2&&this.closeLine&&this.closeLine.removeFrom(this._map)},outClosePoint:function(n){this.closeLine&&this.closeLine.addTo(this._map)},clearMarkers:function(){var n=this;this.markers.forEach(function(s){var a=s.marker;a.removeFrom(n._map)}),this.markers=[]},clearGhostMarkers:function(){var n=this;this.ghostMarkers.forEach(function(s){var a=s.marker;a.removeFrom(n._map)}),this.ghostMarkers=[]},clearPolygon:function(){this.polygon&&this.polygon.removeFrom(this._map),this.polygon=null,this.closeLine&&this.closeLine.removeFrom(this._map),this.closeLine=null},deactivate:function(){wt(this),this.activateButton.classList.remove("active"),this._map.getContainer().classList.remove("drawing-area"),this.setPhase("inactive",!0)},activate:function(){this._map.dragging.disable(),this.activateButton.classList.add("active"),this._map.getContainer().classList.add("drawing-area"),this.setPhase("draw",!0)},_handleMouseMove:function(n){this.options.active&&ze.bind(this)(n)}}),qe=function(n){return n===void 0&&(n={}),new lt(n)};v.Util.extend(v.Control,{DrawAreaSelection:lt,drawAreaSelection:qe});var _t={exports:{}};(function(r,n){(function(s,a){a(n)})(ve,function(s){var a=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnEveryZoom:!1,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyShapePositions:null,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(t){L.Util.setOptions(this,t),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var e=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,e?this._withAnimation:this._noAnimation),this._markerCluster=e?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(t){if(t instanceof L.LayerGroup)return this.addLayers([t]);if(!t.getLatLng)return this._nonPointGroup.addLayer(t),this.fire("layeradd",{layer:t}),this;if(!this._map)return this._needsClustering.push(t),this.fire("layeradd",{layer:t}),this;if(this.hasLayer(t))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(t,this._maxZoom),this.fire("layeradd",{layer:t}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var e=t,i=this._zoom;if(t.__parent)for(;e.__parent._zoom>=i;)e=e.__parent;return this._currentShownBounds.contains(e.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(t,e):this._animationAddLayerNonAnimated(t,e)),this},removeLayer:function(t){return t instanceof L.LayerGroup?this.removeLayers([t]):t.getLatLng?this._map?t.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(t)),this._removeLayer(t,!0),this.fire("layerremove",{layer:t}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),t.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(t)&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,t)&&this.hasLayer(t)&&this._needsRemoving.push({layer:t,latlng:t._latlng}),this.fire("layerremove",{layer:t}),this):(this._nonPointGroup.removeLayer(t),this.fire("layerremove",{layer:t}),this)},addLayers:function(t,e){if(!L.Util.isArray(t))return this.addLayer(t);var i=this._featureGroup,o=this._nonPointGroup,l=this.options.chunkedLoading,h=this.options.chunkInterval,u=this.options.chunkProgress,f=t.length,d=0,p=!0,_;if(this._map){var y=new Date().getTime(),m=L.bind(function(){var C=new Date().getTime();for(this._map&&this._unspiderfy&&this._unspiderfy();d<f;d++){if(l&&d%200===0){var M=new Date().getTime()-C;if(M>h)break}if(_=t[d],_ instanceof L.LayerGroup){p&&(t=t.slice(),p=!1),this._extractNonGroupLayers(_,t),f=t.length;continue}if(!_.getLatLng){o.addLayer(_),e||this.fire("layeradd",{layer:_});continue}if(!this.hasLayer(_)&&(this._addLayer(_,this._maxZoom),e||this.fire("layeradd",{layer:_}),_.__parent&&_.__parent.getChildCount()===2)){var P=_.__parent.getAllChildMarkers(),g=P[0]===_?P[1]:P[0];i.removeLayer(g)}}u&&u(d,f,new Date().getTime()-y),d===f?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(m,this.options.chunkDelay)},this);m()}else for(var k=this._needsClustering;d<f;d++){if(_=t[d],_ instanceof L.LayerGroup){p&&(t=t.slice(),p=!1),this._extractNonGroupLayers(_,t),f=t.length;continue}if(!_.getLatLng){o.addLayer(_);continue}this.hasLayer(_)||k.push(_)}return this},removeLayers:function(t){var e,i,o=t.length,l=this._featureGroup,h=this._nonPointGroup,u=!0;if(!this._map){for(e=0;e<o;e++){if(i=t[e],i instanceof L.LayerGroup){u&&(t=t.slice(),u=!1),this._extractNonGroupLayers(i,t),o=t.length;continue}this._arraySplice(this._needsClustering,i),h.removeLayer(i),this.hasLayer(i)&&this._needsRemoving.push({layer:i,latlng:i._latlng}),this.fire("layerremove",{layer:i})}return this}if(this._unspiderfy){this._unspiderfy();var f=t.slice(),d=o;for(e=0;e<d;e++){if(i=f[e],i instanceof L.LayerGroup){this._extractNonGroupLayers(i,f),d=f.length;continue}this._unspiderfyLayer(i)}}for(e=0;e<o;e++){if(i=t[e],i instanceof L.LayerGroup){u&&(t=t.slice(),u=!1),this._extractNonGroupLayers(i,t),o=t.length;continue}if(!i.__parent){h.removeLayer(i),this.fire("layerremove",{layer:i});continue}this._removeLayer(i,!0,!0),this.fire("layerremove",{layer:i}),l.hasLayer(i)&&(l.removeLayer(i),i.clusterShow&&i.clusterShow())}return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(t){t.off(this._childMarkerEventHandlers,this),delete t.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var t=new L.LatLngBounds;this._topClusterLevel&&t.extend(this._topClusterLevel._bounds);for(var e=this._needsClustering.length-1;e>=0;e--)t.extend(this._needsClustering[e].getLatLng());return t.extend(this._nonPointGroup.getBounds()),t},eachLayer:function(t,e){var i=this._needsClustering.slice(),o=this._needsRemoving,l,h,u;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(i),h=i.length-1;h>=0;h--){for(l=!0,u=o.length-1;u>=0;u--)if(o[u].layer===i[h]){l=!1;break}l&&t.call(e,i[h])}this._nonPointGroup.eachLayer(t,e)},getLayers:function(){var t=[];return this.eachLayer(function(e){t.push(e)}),t},getLayer:function(t){var e=null;return t=parseInt(t,10),this.eachLayer(function(i){L.stamp(i)===t&&(e=i)}),e},hasLayer:function(t){if(!t)return!1;var e,i=this._needsClustering;for(e=i.length-1;e>=0;e--)if(i[e]===t)return!0;for(i=this._needsRemoving,e=i.length-1;e>=0;e--)if(i[e].layer===t)return!1;return!!(t.__parent&&t.__parent._group===this)||this._nonPointGroup.hasLayer(t)},zoomToShowLayer:function(t,e){var i=this._map;typeof e!="function"&&(e=function(){});var o=function(){(i.hasLayer(t)||i.hasLayer(t.__parent))&&!this._inZoomAnimation&&(this._map.off("moveend",o,this),this.off("animationend",o,this),i.hasLayer(t)?e():t.__parent._icon&&(this.once("spiderfied",e,this),t.__parent.spiderfy()))};t._icon&&this._map.getBounds().contains(t.getLatLng())?e():t.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",o,this),this._map.panTo(t.getLatLng())):(this._map.on("moveend",o,this),this.on("animationend",o,this),t.__parent.zoomToBounds())},onAdd:function(t){this._map=t;var e,i,o;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(t),this._nonPointGroup.addTo(t),this._gridClusters||this._generateInitialClusters(),this._maxLat=t.options.crs.projection.MAX_LATITUDE,e=0,i=this._needsRemoving.length;e<i;e++)o=this._needsRemoving[e],o.newlatlng=o.layer._latlng,o.layer._latlng=o.latlng;for(e=0,i=this._needsRemoving.length;e<i;e++)o=this._needsRemoving[e],this._removeLayer(o.layer,!0),o.layer._latlng=o.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),i=this._needsClustering,this._needsClustering=[],this.addLayers(i,!0)},onRemove:function(t){t.off("zoomend",this._zoomEnd,this),t.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(t){for(var e=t;e&&!e._icon;)e=e.__parent;return e||null},_arraySplice:function(t,e){for(var i=t.length-1;i>=0;i--)if(t[i]===e)return t.splice(i,1),!0},_removeFromGridUnclustered:function(t,e){for(var i=this._map,o=this._gridUnclustered,l=Math.floor(this._map.getMinZoom());e>=l&&o[e].removeObject(t,i.project(t.getLatLng(),e));e--);},_childMarkerDragStart:function(t){t.target.__dragStart=t.target._latlng},_childMarkerMoved:function(t){if(!this._ignoreMove&&!t.target.__dragStart){var e=t.target._popup&&t.target._popup.isOpen();this._moveChild(t.target,t.oldLatLng,t.latlng),e&&t.target.openPopup()}},_moveChild:function(t,e,i){t._latlng=e,this.removeLayer(t),t._latlng=i,this.addLayer(t)},_childMarkerDragEnd:function(t){var e=t.target.__dragStart;delete t.target.__dragStart,e&&this._moveChild(t.target,e,t.target._latlng)},_removeLayer:function(t,e,i){var o=this._gridClusters,l=this._gridUnclustered,h=this._featureGroup,u=this._map,f=Math.floor(this._map.getMinZoom());e&&this._removeFromGridUnclustered(t,this._maxZoom);var d=t.__parent,p=d._markers,_;for(this._arraySplice(p,t);d&&(d._childCount--,d._boundsNeedUpdate=!0,!(d._zoom<f));)e&&d._childCount<=1?(_=d._markers[0]===t?d._markers[1]:d._markers[0],o[d._zoom].removeObject(d,u.project(d._cLatLng,d._zoom)),l[d._zoom].addObject(_,u.project(_.getLatLng(),d._zoom)),this._arraySplice(d.__parent._childClusters,d),d.__parent._markers.push(_),_.__parent=d.__parent,d._icon&&(h.removeLayer(d),i||h.addLayer(_))):d._iconNeedsUpdate=!0,d=d.__parent;delete t.__parent},_isOrIsParent:function(t,e){for(;e;){if(t===e)return!0;e=e.parentNode}return!1},fire:function(t,e,i){if(e&&e.layer instanceof L.MarkerCluster){if(e.originalEvent&&this._isOrIsParent(e.layer._icon,e.originalEvent.relatedTarget))return;t="cluster"+t}L.FeatureGroup.prototype.fire.call(this,t,e,i)},listens:function(t,e){return L.FeatureGroup.prototype.listens.call(this,t,e)||L.FeatureGroup.prototype.listens.call(this,"cluster"+t,e)},_defaultIconCreateFunction:function(t){var e=t.getChildCount(),i=" marker-cluster-";return e<10?i+="small":e<100?i+="medium":i+="large",new L.DivIcon({html:"<div><span>"+e+"</span></div>",className:"marker-cluster"+i,iconSize:new L.Point(40,40)})},_bindEvents:function(){var t=this._map,e=this.options.spiderfyOnMaxZoom,i=this.options.showCoverageOnHover,o=this.options.zoomToBoundsOnClick,l=this.options.spiderfyOnEveryZoom;(e||o||l)&&this.on("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),i&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),t.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(t){var e=t.layer,i=e;if(!(t.type==="clusterkeypress"&&t.originalEvent&&t.originalEvent.keyCode!==13)){for(;i._childClusters.length===1;)i=i._childClusters[0];i._zoom===this._maxZoom&&i._childCount===e._childCount&&this.options.spiderfyOnMaxZoom?e.spiderfy():this.options.zoomToBoundsOnClick&&e.zoomToBounds(),this.options.spiderfyOnEveryZoom&&e.spiderfy(),t.originalEvent&&t.originalEvent.keyCode===13&&this._map._container.focus()}},_showCoverage:function(t){var e=this._map;this._inZoomAnimation||(this._shownPolygon&&e.removeLayer(this._shownPolygon),t.layer.getChildCount()>2&&t.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(t.layer.getConvexHull(),this.options.polygonOptions),e.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var t=this.options.spiderfyOnMaxZoom,e=this.options.showCoverageOnHover,i=this.options.zoomToBoundsOnClick,o=this.options.spiderfyOnEveryZoom,l=this._map;(t||i||o)&&this.off("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),e&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),l.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var t=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),t),this._currentShownBounds=t}},_generateInitialClusters:function(){var t=Math.ceil(this._map.getMaxZoom()),e=Math.floor(this._map.getMinZoom()),i=this.options.maxClusterRadius,o=i;typeof i!="function"&&(o=function(){return i}),this.options.disableClusteringAtZoom!==null&&(t=this.options.disableClusteringAtZoom-1),this._maxZoom=t,this._gridClusters={},this._gridUnclustered={};for(var l=t;l>=e;l--)this._gridClusters[l]=new L.DistanceGrid(o(l)),this._gridUnclustered[l]=new L.DistanceGrid(o(l));this._topClusterLevel=new this._markerCluster(this,e-1)},_addLayer:function(t,e){var i=this._gridClusters,o=this._gridUnclustered,l=Math.floor(this._map.getMinZoom()),h,u;for(this.options.singleMarkerMode&&this._overrideMarkerIcon(t),t.on(this._childMarkerEventHandlers,this);e>=l;e--){h=this._map.project(t.getLatLng(),e);var f=i[e].getNearObject(h);if(f){f._addChild(t),t.__parent=f;return}if(f=o[e].getNearObject(h),f){var d=f.__parent;d&&this._removeLayer(f,!1);var p=new this._markerCluster(this,e,f,t);i[e].addObject(p,this._map.project(p._cLatLng,e)),f.__parent=p,t.__parent=p;var _=p;for(u=e-1;u>d._zoom;u--)_=new this._markerCluster(this,u,_),i[u].addObject(_,this._map.project(f.getLatLng(),u));d._addChild(_),this._removeFromGridUnclustered(f,e);return}o[e].addObject(t,h)}this._topClusterLevel._addChild(t),t.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(t){t instanceof L.MarkerCluster&&t._iconNeedsUpdate&&t._updateIcon()})},_enqueue:function(t){this._queue.push(t),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var t=0;t<this._queue.length;t++)this._queue[t].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var t=Math.round(this._map._zoom);this._processQueue(),this._zoom<t&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,t)):this._zoom>t?(this._animationStart(),this._animationZoomOut(this._zoom,t)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(this.options.removeOutsideVisibleBounds){if(L.Browser.mobile)return this._checkBoundsMaxLat(this._map.getBounds())}else return this._mapBoundsInfinite;return this._checkBoundsMaxLat(this._map.getBounds().pad(1))},_checkBoundsMaxLat:function(t){var e=this._maxLat;return e!==void 0&&(t.getNorth()>=e&&(t._northEast.lat=1/0),t.getSouth()<=-e&&(t._southWest.lat=-1/0)),t},_animationAddLayerNonAnimated:function(t,e){if(e===t)this._featureGroup.addLayer(t);else if(e._childCount===2){e._addToMap();var i=e.getAllChildMarkers();this._featureGroup.removeLayer(i[0]),this._featureGroup.removeLayer(i[1])}else e._updateIcon()},_extractNonGroupLayers:function(t,e){var i=t.getLayers(),o=0,l;for(e=e||[];o<i.length;o++){if(l=i[o],l instanceof L.LayerGroup){this._extractNonGroupLayers(l,e);continue}e.push(l)}return e},_overrideMarkerIcon:function(t){var e=t.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[t]}});return e}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(t,e){this._animationAddLayerNonAnimated(t,e)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(t,e){var i=this._getExpandedVisibleBounds(),o=this._featureGroup,l=Math.floor(this._map.getMinZoom()),h;this._ignoreMove=!0,this._topClusterLevel._recursively(i,t,l,function(u){var f=u._latlng,d=u._markers,p;for(i.contains(f)||(f=null),u._isSingleParent()&&t+1===e?(o.removeLayer(u),u._recursivelyAddChildrenToMap(null,e,i)):(u.clusterHide(),u._recursivelyAddChildrenToMap(f,e,i)),h=d.length-1;h>=0;h--)p=d[h],i.contains(p._latlng)||o.removeLayer(p)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(i,e),o.eachLayer(function(u){!(u instanceof L.MarkerCluster)&&u._icon&&u.clusterShow()}),this._topClusterLevel._recursively(i,t,e,function(u){u._recursivelyRestoreChildPositions(e)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(i,t,l,function(u){o.removeLayer(u),u.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(t,e){this._animationZoomOutSingle(this._topClusterLevel,t-1,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t,this._getExpandedVisibleBounds())},_animationAddLayer:function(t,e){var i=this,o=this._featureGroup;o.addLayer(t),e!==t&&(e._childCount>2?(e._updateIcon(),this._forceLayout(),this._animationStart(),t._setPos(this._map.latLngToLayerPoint(e.getLatLng())),t.clusterHide(),this._enqueue(function(){o.removeLayer(t),t.clusterShow(),i._animationEnd()})):(this._forceLayout(),i._animationStart(),i._animationZoomOutSingle(e,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(t,e,i){var o=this._getExpandedVisibleBounds(),l=Math.floor(this._map.getMinZoom());t._recursivelyAnimateChildrenInAndAddSelfToMap(o,l,e+1,i);var h=this;this._forceLayout(),t._recursivelyBecomeVisible(o,i),this._enqueue(function(){if(t._childCount===1){var u=t._markers[0];this._ignoreMove=!0,u.setLatLng(u.getLatLng()),this._ignoreMove=!1,u.clusterShow&&u.clusterShow()}else t._recursively(o,i,l,function(f){f._recursivelyRemoveChildrenFromMap(o,l,e+1)});h._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}),L.markerClusterGroup=function(t){return new L.MarkerClusterGroup(t)};var c=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(t,e,i,o){L.Marker.prototype.initialize.call(this,i?i._cLatLng||i.getLatLng():new L.LatLng(0,0),{icon:this,pane:t.options.clusterPane}),this._group=t,this._zoom=e,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,i&&this._addChild(i),o&&this._addChild(o)},getAllChildMarkers:function(t,e){t=t||[];for(var i=this._childClusters.length-1;i>=0;i--)this._childClusters[i].getAllChildMarkers(t,e);for(var o=this._markers.length-1;o>=0;o--)e&&this._markers[o].__dragStart||t.push(this._markers[o]);return t},getChildCount:function(){return this._childCount},zoomToBounds:function(t){for(var e=this._childClusters.slice(),i=this._group._map,o=i.getBoundsZoom(this._bounds),l=this._zoom+1,h=i.getZoom(),u;e.length>0&&o>l;){l++;var f=[];for(u=0;u<e.length;u++)f=f.concat(e[u]._childClusters);e=f}o>l?this._group._map.setView(this._latlng,l):o<=h?this._group._map.setView(this._latlng,h+1):this._group._map.fitBounds(this._bounds,t)},getBounds:function(){var t=new L.LatLngBounds;return t.extend(this._bounds),t},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(t,e){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(t),t instanceof L.MarkerCluster?(e||(this._childClusters.push(t),t.__parent=this),this._childCount+=t._childCount):(e||this._markers.push(t),this._childCount++),this.__parent&&this.__parent._addChild(t,!0)},_setClusterCenter:function(t){this._cLatLng||(this._cLatLng=t._cLatLng||t._latlng)},_resetBounds:function(){var t=this._bounds;t._southWest&&(t._southWest.lat=1/0,t._southWest.lng=1/0),t._northEast&&(t._northEast.lat=-1/0,t._northEast.lng=-1/0)},_recalculateBounds:function(){var t=this._markers,e=this._childClusters,i=0,o=0,l=this._childCount,h,u,f,d;if(l!==0){for(this._resetBounds(),h=0;h<t.length;h++)f=t[h]._latlng,this._bounds.extend(f),i+=f.lat,o+=f.lng;for(h=0;h<e.length;h++)u=e[h],u._boundsNeedUpdate&&u._recalculateBounds(),this._bounds.extend(u._bounds),f=u._wLatLng,d=u._childCount,i+=f.lat*d,o+=f.lng*d;this._latlng=this._wLatLng=new L.LatLng(i/l,o/l),this._boundsNeedUpdate=!1}},_addToMap:function(t){t&&(this._backupLatlng=this._latlng,this.setLatLng(t)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(t,e,i){this._recursively(t,this._group._map.getMinZoom(),i-1,function(o){var l=o._markers,h,u;for(h=l.length-1;h>=0;h--)u=l[h],u._icon&&(u._setPos(e),u.clusterHide())},function(o){var l=o._childClusters,h,u;for(h=l.length-1;h>=0;h--)u=l[h],u._icon&&(u._setPos(e),u.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(t,e,i,o){this._recursively(t,o,e,function(l){l._recursivelyAnimateChildrenIn(t,l._group._map.latLngToLayerPoint(l.getLatLng()).round(),i),l._isSingleParent()&&i-1===o?(l.clusterShow(),l._recursivelyRemoveChildrenFromMap(t,e,i)):l.clusterHide(),l._addToMap()})},_recursivelyBecomeVisible:function(t,e){this._recursively(t,this._group._map.getMinZoom(),e,null,function(i){i.clusterShow()})},_recursivelyAddChildrenToMap:function(t,e,i){this._recursively(i,this._group._map.getMinZoom()-1,e,function(o){if(e!==o._zoom)for(var l=o._markers.length-1;l>=0;l--){var h=o._markers[l];i.contains(h._latlng)&&(t&&(h._backupLatlng=h.getLatLng(),h.setLatLng(t),h.clusterHide&&h.clusterHide()),o._group._featureGroup.addLayer(h))}},function(o){o._addToMap(t)})},_recursivelyRestoreChildPositions:function(t){for(var e=this._markers.length-1;e>=0;e--){var i=this._markers[e];i._backupLatlng&&(i.setLatLng(i._backupLatlng),delete i._backupLatlng)}if(t-1===this._zoom)for(var o=this._childClusters.length-1;o>=0;o--)this._childClusters[o]._restorePosition();else for(var l=this._childClusters.length-1;l>=0;l--)this._childClusters[l]._recursivelyRestoreChildPositions(t)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(t,e,i,o){var l,h;this._recursively(t,e-1,i-1,function(u){for(h=u._markers.length-1;h>=0;h--)l=u._markers[h],(!o||!o.contains(l._latlng))&&(u._group._featureGroup.removeLayer(l),l.clusterShow&&l.clusterShow())},function(u){for(h=u._childClusters.length-1;h>=0;h--)l=u._childClusters[h],(!o||!o.contains(l._latlng))&&(u._group._featureGroup.removeLayer(l),l.clusterShow&&l.clusterShow())})},_recursively:function(t,e,i,o,l){var h=this._childClusters,u=this._zoom,f,d;if(e<=u&&(o&&o(this),l&&u===i&&l(this)),u<e||u<i)for(f=h.length-1;f>=0;f--)d=h[f],d._boundsNeedUpdate&&d._recalculateBounds(),t.intersects(d._bounds)&&d._recursively(t,e,i,o,l)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){var t=this.options.opacity;return this.setOpacity(0),this.options.opacity=t,this},clusterShow:function(){return this.setOpacity(this.options.opacity)}}),L.DistanceGrid=function(t){this._cellSize=t,this._sqCellSize=t*t,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(t,e){var i=this._getCoord(e.x),o=this._getCoord(e.y),l=this._grid,h=l[o]=l[o]||{},u=h[i]=h[i]||[],f=L.Util.stamp(t);this._objectPoint[f]=e,u.push(t)},updateObject:function(t,e){this.removeObject(t),this.addObject(t,e)},removeObject:function(t,e){var i=this._getCoord(e.x),o=this._getCoord(e.y),l=this._grid,h=l[o]=l[o]||{},u=h[i]=h[i]||[],f,d;for(delete this._objectPoint[L.Util.stamp(t)],f=0,d=u.length;f<d;f++)if(u[f]===t)return u.splice(f,1),d===1&&delete h[i],!0},eachObject:function(t,e){var i,o,l,h,u,f,d,p=this._grid;for(i in p){u=p[i];for(o in u)for(f=u[o],l=0,h=f.length;l<h;l++)d=t.call(e,f[l]),d&&(l--,h--)}},getNearObject:function(t){var e=this._getCoord(t.x),i=this._getCoord(t.y),o,l,h,u,f,d,p,_,y=this._objectPoint,m=this._sqCellSize,k=null;for(o=i-1;o<=i+1;o++)if(u=this._grid[o],u){for(l=e-1;l<=e+1;l++)if(f=u[l],f)for(h=0,d=f.length;h<d;h++)p=f[h],_=this._sqDist(y[L.Util.stamp(p)],t),(_<m||_<=m&&k===null)&&(m=_,k=p)}return k},_getCoord:function(t){var e=Math.floor(t/this._cellSize);return isFinite(e)?e:t},_sqDist:function(t,e){var i=e.x-t.x,o=e.y-t.y;return i*i+o*o}},function(){L.QuickHull={getDistant:function(t,e){var i=e[1].lat-e[0].lat,o=e[0].lng-e[1].lng;return o*(t.lat-e[0].lat)+i*(t.lng-e[0].lng)},findMostDistantPointFromBaseLine:function(t,e){var i=0,o=null,l=[],h,u,f;for(h=e.length-1;h>=0;h--){if(u=e[h],f=this.getDistant(u,t),f>0)l.push(u);else continue;f>i&&(i=f,o=u)}return{maxPoint:o,newPoints:l}},buildConvexHull:function(t,e){var i=[],o=this.findMostDistantPointFromBaseLine(t,e);return o.maxPoint?(i=i.concat(this.buildConvexHull([t[0],o.maxPoint],o.newPoints)),i=i.concat(this.buildConvexHull([o.maxPoint,t[1]],o.newPoints)),i):[t[0]]},getConvexHull:function(t){var e=!1,i=!1,o=!1,l=!1,h=null,u=null,f=null,d=null,p=null,_=null,y;for(y=t.length-1;y>=0;y--){var m=t[y];(e===!1||m.lat>e)&&(h=m,e=m.lat),(i===!1||m.lat<i)&&(u=m,i=m.lat),(o===!1||m.lng>o)&&(f=m,o=m.lng),(l===!1||m.lng<l)&&(d=m,l=m.lng)}i!==e?(_=u,p=h):(_=d,p=f);var k=[].concat(this.buildConvexHull([_,p],t),this.buildConvexHull([p,_],t));return k}}}(),L.MarkerCluster.include({getConvexHull:function(){var t=this.getAllChildMarkers(),e=[],i,o;for(o=t.length-1;o>=0;o--)i=t[o].getLatLng(),e.push(i);return L.QuickHull.getConvexHull(e)}}),L.MarkerCluster.include({_2PI:Math.PI*2,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(!(this._group._spiderfied===this||this._group._inZoomAnimation)){var t=this.getAllChildMarkers(null,!0),e=this._group,i=e._map,o=i.latLngToLayerPoint(this._latlng),l;this._group._unspiderfy(),this._group._spiderfied=this,this._group.options.spiderfyShapePositions?l=this._group.options.spiderfyShapePositions(t.length,o):t.length>=this._circleSpiralSwitchover?l=this._generatePointsSpiral(t.length,o):(o.y+=10,l=this._generatePointsCircle(t.length,o)),this._animationSpiderfy(t,l)}},unspiderfy:function(t){this._group._inZoomAnimation||(this._animationUnspiderfy(t),this._group._spiderfied=null)},_generatePointsCircle:function(t,e){var i=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+t),o=i/this._2PI,l=this._2PI/t,h=[],u,f;for(o=Math.max(o,35),h.length=t,u=0;u<t;u++)f=this._circleStartAngle+u*l,h[u]=new L.Point(e.x+o*Math.cos(f),e.y+o*Math.sin(f))._round();return h},_generatePointsSpiral:function(t,e){var i=this._group.options.spiderfyDistanceMultiplier,o=i*this._spiralLengthStart,l=i*this._spiralFootSeparation,h=i*this._spiralLengthFactor*this._2PI,u=0,f=[],d;for(f.length=t,d=t;d>=0;d--)d<t&&(f[d]=new L.Point(e.x+o*Math.cos(u),e.y+o*Math.sin(u))._round()),u+=l/o+d*5e-4,o+=h/u;return f},_noanimationUnspiderfy:function(){var t=this._group,e=t._map,i=t._featureGroup,o=this.getAllChildMarkers(null,!0),l,h;for(t._ignoreMove=!0,this.setOpacity(1),h=o.length-1;h>=0;h--)l=o[h],i.removeLayer(l),l._preSpiderfyLatlng&&(l.setLatLng(l._preSpiderfyLatlng),delete l._preSpiderfyLatlng),l.setZIndexOffset&&l.setZIndexOffset(0),l._spiderLeg&&(e.removeLayer(l._spiderLeg),delete l._spiderLeg);t.fire("unspiderfied",{cluster:this,markers:o}),t._ignoreMove=!1,t._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(t,e){var i=this._group,o=i._map,l=i._featureGroup,h=this._group.options.spiderLegPolylineOptions,u,f,d,p;for(i._ignoreMove=!0,u=0;u<t.length;u++)p=o.layerPointToLatLng(e[u]),f=t[u],d=new L.Polyline([this._latlng,p],h),o.addLayer(d),f._spiderLeg=d,f._preSpiderfyLatlng=f._latlng,f.setLatLng(p),f.setZIndexOffset&&f.setZIndexOffset(1e6),l.addLayer(f);this.setOpacity(.3),i._ignoreMove=!1,i.fire("spiderfied",{cluster:this,markers:t})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(t,e){var i=this,o=this._group,l=o._map,h=o._featureGroup,u=this._latlng,f=l.latLngToLayerPoint(u),d=L.Path.SVG,p=L.extend({},this._group.options.spiderLegPolylineOptions),_=p.opacity,y,m,k,C,M,P;for(_===void 0&&(_=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),d?(p.opacity=0,p.className=(p.className||"")+" leaflet-cluster-spider-leg"):p.opacity=_,o._ignoreMove=!0,y=0;y<t.length;y++)m=t[y],P=l.layerPointToLatLng(e[y]),k=new L.Polyline([u,P],p),l.addLayer(k),m._spiderLeg=k,d&&(C=k._path,M=C.getTotalLength()+.1,C.style.strokeDasharray=M,C.style.strokeDashoffset=M),m.setZIndexOffset&&m.setZIndexOffset(1e6),m.clusterHide&&m.clusterHide(),h.addLayer(m),m._setPos&&m._setPos(f);for(o._forceLayout(),o._animationStart(),y=t.length-1;y>=0;y--)P=l.layerPointToLatLng(e[y]),m=t[y],m._preSpiderfyLatlng=m._latlng,m.setLatLng(P),m.clusterShow&&m.clusterShow(),d&&(k=m._spiderLeg,C=k._path,C.style.strokeDashoffset=0,k.setStyle({opacity:_}));this.setOpacity(.3),o._ignoreMove=!1,setTimeout(function(){o._animationEnd(),o.fire("spiderfied",{cluster:i,markers:t})},200)},_animationUnspiderfy:function(t){var e=this,i=this._group,o=i._map,l=i._featureGroup,h=t?o._latLngToNewLayerPoint(this._latlng,t.zoom,t.center):o.latLngToLayerPoint(this._latlng),u=this.getAllChildMarkers(null,!0),f=L.Path.SVG,d,p,_,y,m,k;for(i._ignoreMove=!0,i._animationStart(),this.setOpacity(1),p=u.length-1;p>=0;p--)d=u[p],d._preSpiderfyLatlng&&(d.closePopup(),d.setLatLng(d._preSpiderfyLatlng),delete d._preSpiderfyLatlng,k=!0,d._setPos&&(d._setPos(h),k=!1),d.clusterHide&&(d.clusterHide(),k=!1),k&&l.removeLayer(d),f&&(_=d._spiderLeg,y=_._path,m=y.getTotalLength()+.1,y.style.strokeDashoffset=m,_.setStyle({opacity:0})));i._ignoreMove=!1,setTimeout(function(){var C=0;for(p=u.length-1;p>=0;p--)d=u[p],d._spiderLeg&&C++;for(p=u.length-1;p>=0;p--)d=u[p],d._spiderLeg&&(d.clusterShow&&d.clusterShow(),d.setZIndexOffset&&d.setZIndexOffset(0),C>1&&l.removeLayer(d),o.removeLayer(d._spiderLeg),delete d._spiderLeg);i._animationEnd(),i.fire("unspiderfied",{cluster:e,markers:u})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(t){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(t))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(t){this._spiderfied&&this._spiderfied.unspiderfy(t)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(t){t._spiderLeg&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow(),t.setZIndexOffset&&t.setZIndexOffset(0),this._map.removeLayer(t._spiderLeg),delete t._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(t){return t?t instanceof L.MarkerClusterGroup?t=t._topClusterLevel.getAllChildMarkers():t instanceof L.LayerGroup?t=t._layers:t instanceof L.MarkerCluster?t=t.getAllChildMarkers():t instanceof L.Marker&&(t=[t]):t=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(t),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(t),this},_flagParentsIconsNeedUpdate:function(t){var e,i;for(e in t)for(i=t[e].__parent;i;)i._iconNeedsUpdate=!0,i=i.__parent},_refreshSingleMarkerModeMarkers:function(t){var e,i;for(e in t)i=t[e],this.hasLayer(i)&&i.setIcon(this._overrideMarkerIcon(i))}}),L.Marker.include({refreshIconOptions:function(t,e){var i=this.options.icon;return L.setOptions(i,t),this.setIcon(i),e&&this.__parent&&this.__parent._group.refreshClusters(this),this}}),s.MarkerClusterGroup=a,s.MarkerCluster=c,Object.defineProperty(s,"__esModule",{value:!0})})})(_t,_t.exports);let U=[],O=null;const Ve=r=>{U.length&&U.forEach(n=>{n.removeEventListener("click")}),O&&r.removeLayer(O),U=[]},Xe=r=>{const n=z(ot),s=z(mt),{id:a,spotStatus:c,img:t,title:e,videoLink:i,user:o,publicBanner:{banner:l,bannerUrl:h},location:{lat:u,lng:f}}=r;It.set({...r,status:c,img:{src:t,title:e||a},video:i,firm:{banner:l,bannerUrl:h},coords:{lat:u,lng:f}}),n("/@:username/spot/:id",{username:o.username,id:a}),s||(document.getElementById("highlighted").innerHTML="")},Ye=r=>{const{id:n,location:{lat:s,lng:a},icon:c,thumbnail:t}=r,e=N.marker([s,a],{icon:de(c||t,n)});return e.addEventListener("click",()=>Xe(r)),e.spotId=n,e},We=(r,n)=>{const{center:{lat:s,lng:a},spotcnt:c}=r,t=N.marker([s,a],{icon:fe(c)});return t.addEventListener("click",()=>n.setView([s,a],14)),t},Ke=(r,n,s)=>{var c,t;O=N.markerClusterGroup({chunkedLoading:!0,spiderfyOnMaxZoom:!1,showCoverageOnHover:!1,iconCreateFunction:ce});const a=[];if((c=n==null?void 0:n.spots)==null||c.forEach(e=>{var o;const i=Ye(e);i.isAdditionalCategory=(o=z(xt).find(l=>l.id===e.categoryId))==null?void 0:o.isAdditional,O.addLayer(i),U.push(i),a.push(i)}),(t=n==null?void 0:n.clusters)==null||t.forEach(e=>{const i=We(e,r);i.count=e.spotcnt,O.addLayer(i),U.push(i),a.push(i)}),O.on("clusterclick",e=>{if(e.layer._zoom===Ot){const i=z(ot),o=e.layer.getAllChildMarkers(),l=n==null?void 0:n.spots.filter(d=>o.some(p=>p.spotId===d.id));Bt.set(l);const h=e.layer.getBounds().pad(20),f=[h.getNorthEast(),h.getNorthWest(),h.getSouthEast(),h.getSouthWest()].map(d=>[ft(d.lng),ft(d.lat)]);i("/selected-spots",{poly:f})}}),r.addLayer(O),s){const e=new N.featureGroup(a);r.fitBounds(e.getBounds())}window.dispatchEvent(At)},gt=(r,n,s)=>{var a,c;Ve(r),(((a=n==null?void 0:n.spots)==null?void 0:a.length)>0||((c=n==null?void 0:n.clusters)==null?void 0:c.length)>0)&&Ke(r,n,s)};function Qe(r){let n;return{c(){n=kt("div"),n.innerHTML='<div class="train svelte-1a70k6t"><div class="windows svelte-1a70k6t"></div> <div class="lights svelte-1a70k6t"></div></div> <div class="rails svelte-1a70k6t"><div class="ties svelte-1a70k6t"></div> <div class="ties svelte-1a70k6t"></div> <div class="ties svelte-1a70k6t"></div></div>',Ct(n,"class","loader svelte-1a70k6t")},m(s,a){H(s,n,a)},p:F,i:F,o:F,d(s){s&&q(n)}}}class Je extends vt{constructor(n){super(),Lt(this,n,null,Qe,yt,{})}}const{window:$e}=he;function ti(r){let n,s,a,c,t;const e=r[8].default,i=Ht(e,r,r[7],null);return{c(){n=kt("div"),s=qt(),i&&i.c(),Ct(n,"class","map svelte-d2benj"),Z(n,"add-mode",r[1]),Z(n,"area-selection-mode",r[2])},m(o,l){H(o,n,l),H(o,s,l),i&&i.m(o,l),a=!0,c||(t=Vt(r[3].call(null,n)),c=!0)},p(o,l){(!a||l&2)&&Z(n,"add-mode",o[1]),(!a||l&4)&&Z(n,"area-selection-mode",o[2]),i&&i.p&&(!a||l&128)&&Xt(i,e,o,o[7],a?Wt(e,o[7],l,null):Yt(o[7]),null)},i(o){a||(X(i,o),a=!0)},o(o){V(i,o),a=!1},d(o){o&&(q(n),q(s)),i&&i.d(o),c=!1,t()}}}function ei(r){let n,s;return n=new Je({}),{c(){Kt(n.$$.fragment)},m(a,c){Qt(n,a,c),s=!0},p:F,i(a){s||(X(n.$$.fragment,a),s=!0)},o(a){V(n.$$.fragment,a),s=!1},d(a){Jt(n,a)}}}function ii(r){let n,s,a,c,t,e;const i=[ei,ti],o=[];function l(h,u){return h[0]?0:1}return n=l(r),s=o[n]=i[n](r),{c(){s.c(),a=Gt()},m(h,u){o[n].m(h,u),H(h,a,u),c=!0,t||(e=Rt($e,"resize",Zt),t=!0)},p(h,[u]){let f=n;n=l(h),n===f?o[n].p(h,u):(Ft(),V(o[f],1,1,()=>{o[f]=null}),Ut(),s=o[n],s?s.p(h,u):(s=o[n]=i[n](h),s.c()),X(s,1),s.m(a.parentNode,a))},i(h){c||(X(s),c=!0)},o(h){V(s),c=!1},d(h){h&&q(a),o[n].d(h),t=!1,e()}}}function ni(r,n,s){let a,c,t,e,i,o,l,h,u,f,d,p,_,y;b(r,$t,g=>s(4,a=g)),b(r,te,g=>s(5,c=g)),b(r,tt,g=>s(6,t=g)),b(r,ct,g=>s(9,e=g)),b(r,ht,g=>s(10,i=g)),b(r,ee,g=>s(11,o=g)),b(r,ie,g=>s(12,l=g)),b(r,ne,g=>s(13,h=g)),b(r,re,g=>s(14,u=g)),b(r,oe,g=>s(15,g)),b(r,se,g=>s(16,f=g)),b(r,ae,g=>s(17,d=g)),b(r,le,g=>s(0,p=g)),b(r,ue,g=>s(1,_=g)),b(r,mt,g=>s(2,y=g));let{$$slots:m={},$$scope:k}=n;ot.set(d),f(g=>(console.log(""),console.log(">>> $beforeUrlChange"),console.log("event.route",g.route),console.log("event.route.mode",g.route.mode),console.log("window.history.state",window.history.state),!0)),u(g=>{console.log(""),console.log("data",g),console.log("window.history.state",window.history.state),Nt.set(!0)});let C=Dt("categories")||[1];ht.set(new lt({onPolygonReady:g=>{Tt.set(!0),g.setStyle({color:"var(--color-accent)",weight:4,fillOpacity:.18});const{coordinates:Q}=g.toGeoJSON().geometry;me(Q[0])},position:"bottomright"}));const M=new Se;ct.set(new Pe({provider:M,position:"topright",style:"button",showMarker:!1,searchLabel:"Search",maxSuggestions:jt()?3:5,autoClose:!0}));const P=g=>{var ut;const Q=C.includes(2)?[dt,pe]:[dt];return tt.set(N.map(g,{layers:Q})),t.zoomControl.setPosition("bottomleft"),h.length>0?(t.fitBounds(h),(ut=c==null?void 0:c.spots)!=null&&ut.length&&gt(t,c,a)):_e(t),t.on("moveend",()=>l&&ge(t)),t.on("zoomend",()=>zt.set(t.getZoom())),document.addEventListener("click",J=>{if(o){const Et=document.querySelector(".geosearch"),$=document.querySelector(".search-artist");!Et.contains(J.target)&&!($!=null&&$.contains(J.target))&&e.close(),J.target.classList.contains("item")&&e.clearResults()}}),t.addControl(i),t.addControl(e),{destroy:()=>{t.remove(),tt.set(null)}}};return r.$$set=g=>{"$$scope"in g&&s(7,k=g.$$scope)},r.$$.update=()=>{r.$$.dirty&112&&t&&c&&gt(t,c,a)},[p,_,y,P,a,c,t,k,m]}class _i extends vt{constructor(n){super(),Lt(this,n,ni,ii,yt,{})}}export{_i as default};
