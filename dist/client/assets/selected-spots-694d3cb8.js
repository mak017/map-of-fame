import{S as K,i as Q,s as Z,aQ as A,I as b,H as C,a as L,K as _,b as I,ax as k,m as H,h as g,g as oe,t as y,f as re,l as O,d as B,T,au as j,a9 as N,b6 as ne,bO as V,aH as ie,bP as ce,E as ue,o as fe,M as R,e as me,aw as pe,aZ as D,ad as de,a$ as _e,b0 as ge,aT as Y,ac as he,ao as Se,an as ke,ab as ve,aS as be,aU as we,aV as $e}from"./index-b97375a6.js";import{e as G}from"./each-8cb05188.js";import{f as Me,M as Te}from"./Modal-eca6e7db.js";import{a as ye}from"./init-36a9a4f8.js";import{C as Ae}from"./CustomSelect-0c273d97.js";import{S as Ye}from"./ShowOnMapButton-7b9bb6cb.js";import"./globals-7f7f1b26.js";import"./auth-42cd4e99.js";import"./endpoints-5fb45e2d.js";import"./spot-444f4e46.js";import"./transformers-2ad5cf36.js";import"./SelectIndicatorSvg-371d91b9.js";function P(a,s,t){const e=a.slice();return e[18]=s[t],e}function U(a){let s,t;return s=new Ye({props:{onClick:a[5]}}),{c(){L(s.$$.fragment)},m(e,l){H(s,e,l),t=!0},p:R,i(e){t||(g(s.$$.fragment,e),t=!0)},o(e){y(s.$$.fragment,e),t=!1},d(e){B(s,e)}}}function z(a){let s,t=G(a[1]),e=[];for(let l=0;l<t.length;l+=1)e[l]=F(P(a,t,l));return{c(){for(let l=0;l<e.length;l+=1)e[l].c();s=me()},m(l,o){for(let r=0;r<e.length;r+=1)e[r]&&e[r].m(l,o);I(l,s,o)},p(l,o){if(o&18){t=G(l[1]);let r;for(r=0;r<t.length;r+=1){const m=P(l,t,r);e[r]?(e[r].p(m,o),g(e[r],1)):(e[r]=F(m),e[r].c(),g(e[r],1),e[r].m(s.parentNode,s))}for(;r<e.length;r+=1)e[r].d(1);e.length=t.length}},i(l){for(let o=0;o<t.length;o+=1)g(e[o])},o:R,d(l){l&&O(s),pe(e,l)}}}function F(a){let s,t,e,l,o,r,m,v;function w(){return a[9](a[18])}return{c(){s=b("button"),t=b("img"),r=C(),_(t,"loading","lazy"),D(t.src,e=a[18].thumbnail)||_(t,"src",e),_(t,"alt",l=a[18].title??`Spot ${a[18].id} from area`),_(t,"class","svelte-s84lk8"),_(s,"class","button spot-card svelte-s84lk8")},m(p,h){I(p,s,h),k(s,t),k(s,r),m||(v=de(s,"click",w),m=!0)},p(p,h){a=p,h&2&&!D(t.src,e=a[18].thumbnail)&&_(t,"src",e),h&2&&l!==(l=a[18].title??`Spot ${a[18].id} from area`)&&_(t,"alt",l)},i(p){o||_e(()=>{o=ge(t,Me,{duration:200}),o.start()})},o:R,d(p){p&&O(s),m=!1,v()}}}function Ce(a){let s,t,e,l,o,r,m,v,w,p,h;m=new Ae({props:{items:a[2],selectedValue:{value:a[0],label:a[0]},isYear:!0}}),m.$on("select",a[3]);let u=a[0]===A&&U(a),c=a[1]&&z(a);return{c(){s=b("div"),t=b("div"),t.innerHTML='<div class="title svelte-s84lk8">Selected spots</div>',e=C(),l=b("div"),o=b("div"),r=b("div"),L(m.$$.fragment),v=C(),u&&u.c(),w=C(),p=b("div"),c&&c.c(),_(t,"class","top svelte-s84lk8"),_(r,"class","year-select svelte-s84lk8"),_(o,"class","data-top svelte-s84lk8"),_(p,"class","spots svelte-s84lk8"),_(l,"class","data svelte-s84lk8"),_(s,"class","container svelte-s84lk8")},m(i,S){I(i,s,S),k(s,t),k(s,e),k(s,l),k(l,o),k(o,r),H(m,r,null),k(o,v),u&&u.m(o,null),k(l,w),k(l,p),c&&c.m(p,null),h=!0},p(i,[S]){const $={};S&4&&($.items=i[2]),S&1&&($.selectedValue={value:i[0],label:i[0]}),m.$set($),i[0]===A?u?(u.p(i,S),S&1&&g(u,1)):(u=U(i),u.c(),g(u,1),u.m(o,null)):u&&(oe(),y(u,1,1,()=>{u=null}),re()),i[1]?c?(c.p(i,S),S&2&&g(c,1)):(c=z(i),c.c(),g(c,1),c.m(p,null)):c&&(c.d(1),c=null)},i(i){h||(g(m.$$.fragment,i),g(u),g(c),h=!0)},o(i){y(m.$$.fragment,i),y(u),h=!1},d(i){i&&O(s),B(m),u&&u.d(),c&&c.d()}}}function Le(a,s,t){let e,l,o,r,m,v;T(a,j,n=>t(11,e=n)),T(a,N,n=>t(7,l=n)),T(a,ne,n=>t(8,o=n)),T(a,V,n=>t(12,r=n)),T(a,ie,n=>t(13,m=n)),T(a,ce,n=>t(14,v=n));let w=!0,p=v.route.state.id;if(ue(()=>{V.set({...r,[p]:{areaSpots:o,clusterSpots:l}})}),fe(()=>{N.set([]),w||(document.getElementById("highlighted").innerHTML="")}),!(o!=null&&o.length)&&!(l!=null&&l.length)){const{poly:n}=m,f=n==null?void 0:n.split("/").reduce((d,M)=>{const E=M.split(",");return d.push(E),d},[]);(f==null?void 0:f.length)<2||!(f!=null&&f.every(d=>d.length===2))?e("/"):(ye(f,p),w=!1)}const h=()=>{if(r[p]){const{areaSpots:n,clusterSpots:f}=r[p];return f!=null&&f.length?f:n??[]}return l!=null&&l.length?l:o},u=()=>{var n,f;return[A,...new Set((f=((n=r[p])==null?void 0:n.areaSpots)||o)==null?void 0:f.map(({year:d})=>d===null?Y:d).filter(d=>d).sort((d,M)=>(d===Y)-(M===Y)||-(d>M)||+(d<M)))]};let c=A,i=h(),S=i,$=u();const J=n=>{const{value:f}=n.detail.detail;t(0,c=f!==Y?f:null),t(1,S=c===A?i:i.filter(d=>d.year===c))},q=n=>{const{id:f,spotStatus:d,img:M,title:E,videoLink:x,publicBanner:{banner:ee,bannerUrl:te},location:{lat:se,lng:le},user:ae}=n;he.set({...n,status:d,img:{src:M,title:E||f},video:x,firm:{banner:ee,bannerUrl:te},coords:{lat:se,lng:le}}),e("/@:username/spot/:id",{username:ae.username,id:f})},W=()=>{Se.set({spots:i,years:$}),ke.set(!0),ve.set(!0),be.set(c),we.set(""),$e.set(""),e("/")},X=n=>q(n);return a.$$.update=()=>{a.$$.dirty&448&&(o||l)&&(t(6,i=h()),t(1,S=i),t(2,$=u()))},[c,S,$,J,q,W,i,l,o,X]}class He extends K{constructor(s){super(),Q(this,s,Le,Ce,Z,{})}}function Be(a){let s,t;return s=new He({}),{c(){L(s.$$.fragment)},m(e,l){H(s,e,l),t=!0},i(e){t||(g(s.$$.fragment,e),t=!0)},o(e){y(s.$$.fragment,e),t=!1},d(e){B(s,e)}}}function Ee(a){let s,t;return s=new Te({props:{id:"selected-spots-modal",noLogo:!0,$$slots:{default:[Be]},$$scope:{ctx:a}}}),s.$on("close",a[1]),{c(){L(s.$$.fragment)},m(e,l){H(s,e,l),t=!0},p(e,[l]){const o={};l&4&&(o.$$scope={dirty:l,ctx:e}),s.$set(o)},i(e){t||(g(s.$$.fragment,e),t=!0)},o(e){y(s.$$.fragment,e),t=!1},d(e){B(s,e)}}}function Ie(a,s,t){let e;return T(a,j,o=>t(0,e=o)),[e,()=>{e("/")}]}class Qe extends K{constructor(s){super(),Q(this,s,Ie,Ee,Z,{})}}export{Qe as default};
